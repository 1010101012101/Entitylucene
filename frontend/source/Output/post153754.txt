SMB: auto-unmount then unable to re-mount without restart <body> I have a recurring problem with mounting/un-mounting remote directories via SMB, however I don't know what triggers the problem nor how to resolve it.  strongBackground:/strong  After successfully mounting the directory via SMB and some time using it, the directory seems to unmount by itself. When this happens, I am unable to re-mount the directory until I restart my system.  If I don't restart the system and use the "Connect to Server" dialog to try to mount the directory via SMB, the dialog disappears as though the connection was successful, however nothing is mounted.  If I try to do the same thing with a parent directory (which is the root directory of the server), then the connection appears to be successful and prompts me to "Select the volumes you want to mount on 'xyz.server.name':" with a listing of directories. The directory that I previously mounted (which auto-unmounted) is listed, but is ghosted out and therefore unable to be selected.  When SSH-ing into the server, there does not appear to be any problem with accessing the directory.  This problem occurs for other remote directories as well (though I have not been able to test it on another server).  Also, when trying to reconnect under this scenario, Console reports the following issue:  "30/10/2014 11:48:20.520 am NetAuthSysAgent[3346]: smb_mount: mount failed to my.server.com/mydirectory, syserr = File exists"  strongQuestions:/strong  i) What is causing the directory/volume to be unmounted?  ii) How can I prevent the auto-unmount from happening?  iii) If an auto-unmount occurs, how can I re-mount the directory without restarting?  strongSystem details:/strong  OS X 10.9.5  Retina, 15-inch, Early 2013  strongServer details:/strong  Red Hat Enterprise Linux Server release 5.11 (Tikanga)  Kernel version 2.6.18-371.8.1.el5  strongOutput of df:/strong  Before problem:  precodeFilesystem                                        512-blocks        Used  Available Capacity   iused      ifree %iused  Mounted on /dev/disk0s2                                       975425848   899360656   75553192    93% 112484080    9444149   92%   / devfs                                                    371         371          0   100%       644          0  100%   /dev map -hosts                                                 0           0          0   100%         0          0  100%   /net map auto_home                                              0           0          0   100%         0          0  100%   /home //josh@example.com/josh                          10568950416 10486471008   82479408   100%         0 18446744073709551615    0%   /Volumes/josh //josh@example.com/semantic                      12682735248  7708953400 4973781848    61%         0 18446744073709551615    0%   /Volumes/semantic /code/pre  After problem:  precodeFilesystem                                        512-blocks        Used  Available Capacity   iused      ifree %iused  Mounted on /dev/disk0s2                                       975425848   899350976   75562872    93% 112482870    9445359   92%   / devfs                                                    373         373          0   100%       648          0  100%   /dev map -hosts                                                 0           0          0   100%         0          0  100%   /net map auto_home                                              0           0          0   100%         0          0  100%   /home //josh@example.com/josh                          10568950416 10466951592  101998824   100%         0 18446744073709551615    0%   /Volumes/josh //josh@example.com/semantic                      12682735248  7708953400 4973781848    61%         0 18446744073709551615    0%   /Volumes/semantic /code/pre  Observations:  The mounted directories are still listed in /Volumes when viewed from the terminal, (i.e.  'ls /Volumes'), though this is not always the case, but both directories are inaccessible. They are not visible within Finder at all.  However, I am able to still access the content of one of the directories from Matlab, which was already within a subdirectory of this directory (its working directory). If I then move outside of the directory in Matlab (say, to my home directory), I am unable to return to it via the 'cd' command but instead need to press the back button within the file navigation toolbar and then everything is accessible again from within Matlab.  <answer155247> According to the Red Hat site, they don't support using SMB shares using the OS X Finder. Looks like you can still get at it using the Terminal, so that could be a workaround for now.  In regards to the random disconnect: It sounds like the share will connect initially, and then freak out after it realizes it's in the Mac environment. Looks to me like the share doesn't unmount correctly, and that's why you wouldn't be able to re-connect to it. It's actually still there, just not visible in Finder.  If you were to manually unmount the share using the Terminal, I'd expect it wouldn't be greyed out if you were to try and connect to it again.  A fix: Depending on how the Red Hat server was set up, you should be able to FTP into it. Mac has a few FTP GUIs that you can try out, or use the Terminal's codeftp/code command.  <answer155261> I'm going to put up an answer to question 3. Not sure the rest can be easily diagnosed.  "If an auto-unmount occurs, how can I re-mount the directory without restarting?"  Try codediskutil umount /Volumes/josh/code and it should do the trick.  The "File exists" error is showing up because the mount point it wants to use is already present. Looks like the disk isn't actually unmounted, just that Finder can't see it. This is why Matlab can still access the files on it.  <answer155638>    What is causing the directory/volume to be unmounted?   Most probably a network connection instability which might be amplified by the use of the codeAutomatic/code configuration which might switch from Ethernet to Airport trying to maintain your network connectivity.  To validate this hypothesis, use:  precodenetstat -I ping -c 90 -i 10 your_SMB_server tail -f /var/log/system.log ... /code/pre     How can I prevent the auto-unmount from happening?   If this netwok problem is confirmed, then fix it :):  ul lichange cable/li lichange switch port/li liask your network admin/li li.../li /ul     If an auto-unmount occurs, how can I re-mount the directory without   restarting?   You can't if the codeunmount/code didn't terminate correctly. Some state information within your SMB kernel extension is corrupted (half modified) and can't be fixed in any other way than the correct termination of the pending codeunmount/code. If your connection was broken, I know of one uniq way to terminate a pending SMB codeunmount/code: codeshutdown/code of Mac OS X (I tried a codekextunload/code which lead to a total failure).  You should absolutely avoid such a pending unmount to occur.  <answer190740> The answer from miken32 didn't work for me, but got me on the right track. My problem was solved after unmounting emall/em shares on the server in question (in your case "example.com").  So, using your case, codediskutil umount /Volumes/josh/code isn't enough, because code/Volumes/semantic/code still remains. You must unmount that one, too. After that, remounting should work (it did at least for me).  Bi the way, you don't have to use diskutil, instead you can execute  precodeumount //josh@example.com/josh /code/pre  and  precodeumount //josh@example.com/semantic /code/pre  <answer245654> I have same problem, had it on 10.6.8 and now on 10.11. The cause is twofold: for one, share is supposed to unmount (e.g. on sleep), but it cannot because it is being (flagged as) used, so it dies and what is left is a folder in /Volumes which you could sometimes just delete and then remount. However in 10.11 it is invisible in Finder AFTER the share dies (see Finder preferences, they say Finder shows only active shares.   For the second, the flag that the files are in use is set by MatLab. Some times you can remove them by MatLab command codefclose all/code and cd to some other place to free the share, some times you actually do use files (by editing .m script from the share). But often after a period of inactivity it goes in a dead lock: codeumount/code and codediskutil unmount/code cannot release the share because "Resource busy" and MatLab cannot release its flags because the share is long gone.  I use macfusion, so there indeed is a mechanism for the share to die when sshfs looses connection to the server. Out of these three: Finder, MatLab and fuse, I would say the MatLab is evil, as other programs like BBedit never lock the share in such a deadly way. I often can remount only after I quit MatLab.  <comment182184> did you try to switch to cifs instead of smb2? [maosxhints](http://hints.macworld.com/article.php?story=20131122083837447) <comment182633> That's a very old RHEL install. I have Samba4 running on Scientific Linux 6.5 (RHEL clone) without any issues at all. <comment182634> Sorry, meant to write more there. What version of Samba are you running? Do you get anything on the server side error log? Any network connectivity issues or computer sleeping that could be causing the disconnection? <comment182939> Is this a Finder, client or server problem. When your unmounting problem ocurs, is it possible to do `cd /Volumes/josh` from `Terminal`? <comment183018> This works as far as unmounting is concerned, but I am unable to remount the directory afterwards. <comment183019> Yes, I am using FTP for file transfer when I have problems with SMB, however (as far I know) FTP doesn't allow me to utilise the files remotely within my local applications (e.g. Matlab). Transferring files just for editing/updating becomes cumbersome and error-prone. <comment183020> @klanomath yes, I have tried cifs, but it did not seem to work in my case. <comment183022> @miken32: Samba version 3.6.23. I don't have admin privileges on the server. There does not seem to be any connectivity issues with the server in general, as I have other network-based services connected/running (e.g. SSH) without any interruption/problems. The issue occurs when my system is in continual active use. <comment183023> I'm assuming you don't have access to the RHEL server, correct? If you do, you should be able to use [Netatalk](https://www.afp548.com/2013/05/06/afp-services-on-a-linux-server/) to make an AFP share, and THAT should work just fine.   Are you using a GUI like Filezilla? Or are you using the Terminal's `ftp` command to access the files? I've had pretty good luck using Filezilla (although I've never had to deal with Matlab).  Unfortunately, I don't see a reliable workaround if you don't have access to the server. Maybe get in touch with the server manager and ask about Netatalk. <comment183025> @danielAzuelos: No, I can't cd into `/Volumes/josh` from within Terminal, despite still having access to the directory and its contents within Matlab. <comment183099> Try to quit Matlab, this might be the origin of a legitimate unmount operation which can't terminate properly because of Matlab keeping files open. <comment184240> @danielAzuelos, the OP states he can ssh into the host at any time. <comment184241> I prefer sshfs for my linux mounts. This disables the need for smb and only requires ssh to be setup. It mounts my linux host as any network disk would mount. However, this is a workaround for your problem, and not a fix. Btw, very well described problem.