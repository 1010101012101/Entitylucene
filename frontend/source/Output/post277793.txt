Trying to script partitioning Macintosh HD in command line? <body> I am trying to script partitioning the codeMacintosh HD/code. I am running   precodediskutil partitionDisk /dev/disk0 GPT JHFS+ New 100g /code/pre  in command line and I'm getting this error.  precodeStarted partitioning on disk0 Unmounting disk Error: -69877: Couldn't open device (Is a disk in use by a storage system such as AppleRAID, CoreStorage, or APFS?) /code/pre  So it seems like it's having problems dismounting codeMacintosh HD/code because that's what my laptop is running on. How do I partition codeMacintosh HD/code while booted on it?  diskutil list  precode/dev/disk0 (internal, physical):    #:                       TYPE NAME                    SIZE           IDENTIFIER    0:      GUID_partition_scheme                        *500.3 GB       disk0    1:                        EFI EFI                     209.7 MB       disk0s1    2:          Apple_CoreStorage Macintosh HD            499.4 GB       disk0s2    3:                 Apple_Boot Recovery HD             650.0 MB       disk0s3  /dev/disk1 (internal, virtual):    #:                       TYPE NAME                    SIZE           IDENTIFIER    0:                  Apple_HFS Macintosh HD           +499.1 GB       disk1                              Logical Volume on disk0s2                              EFDB0B2F-EEBB-4CAC-8AFE-69F4C1803A54                              Unlocked Encrypted /code/pre  diskutil coreStorage list  precodeCoreStorage logical volume groups (1 found) | +-- Logical Volume Group 5E012656-B5D2-43E3-999F-5EF2E2D0C138 ========================================================= Name:         Macintosh HD Status:       Online Size:         499418034176 B (499.4 GB) Free Space:   10645504 B (10.6 MB) | +-&lt; Physical Volume 404807DA-ADE9-4CAE-B449-279488379018 |   ---------------------------------------------------- |   Index:    0 |   Disk:     disk0s2 |   Status:   Online |   Size:     499418034176 B (499.4 GB) | +-&gt; Logical Volume Family 78187C7A-2A55-48A1-AEE3-25AD3A9E3538     ----------------------------------------------------------     Encryption Type:         AES-XTS     Encryption Status:       Unlocked     Conversion Status:       Complete     High Level Queries:      Fully Secure     |                        Passphrase Required     |                        Accepts New Users     |                        Has Visible Users     |                        Has Volume Key     |     +-&gt; Logical Volume EFDB0B2F-EEBB-4CAC-8AFE-69F4C1803A54         ---------------------------------------------------         Disk:                  disk1         Status:                Online         Size (Total):          499055067136 B (499.1 GB)         Revertible:            Yes (unlock and decryption required)         Revert Status:         Reboot required         LV Name:               Macintosh HD         Volume Name:           Macintosh HD         Content Hint:          Apple_HFS /code/pre  diskutil apfs list  precodeNo APFS Containers found /code/pre  <answer277824> Your main disk is already partitioned. You can't use codediskutil partitionDisk /dev/disk0 GPT .../code booted to the same disk.  hr  In my opinion you have three options:  ol liResize the current Logical Volume "Macintosh HD" and create a second logical volume in the LVG/li liResize the whole stack and add a fourth volume at the end/li liCreate a growing sparsebundle image in your encrypted volume "Macintosh HD"/li /ol  hr  ol liResize the logical volume:  ul liresize the logical volume:  precodediskutil cs resizeVolume EFDB0B2F-EEBB-4CAC-8AFE-69F4C1803A54 399055m /code/pre/li liadd a second logical volume in the free LVG space:  precodediskutil cs createVolume 5E012656-B5D2-43E3-999F-5EF2E2D0C138 jhfsx "dev" 100% /code/pre/li liResult:  precode/dev/disk0 (internal, physical):   #:                       TYPE NAME                    SIZE           IDENTIFIER   0:      GUID_partition_scheme                        *500.3 GB       disk0   1:                        EFI EFI                     209.7 MB       disk0s1   2:          Apple_CoreStorage Macintosh HD            499.4 GB       disk0s2   3:                 Apple_Boot Recovery HD             650.0 MB       disk0s3  /dev/disk1 (internal, virtual):   #:                       TYPE NAME                    SIZE           IDENTIFIER   0:                  Apple_HFS Macintosh HD           +399.1 GB       disk1                          Logical Volume on disk0s2                          EFDB0B2F-EEBB-4CAC-8AFE-69F4C1803A5                          Unlocked Encrypted /dev/disk2 (internal, virtual):   #:                       TYPE NAME                    SIZE           IDENTIFIER   0:                  Apple_HFS dev                     100.0 GB       disk2                          Logical Volume on disk0s2                          C7C75FC4-4062-42E7-B2F5-576CFCA257854                          Unencrypted /code/pre/li /ul/li liResize the stack:  ul liresize the whole stack:  precodediskutil cs resizeStack EFDB0B2F-EEBB-4CAC-8AFE-69F4C1803A54 399055m /code/pre/li liadd a fourth volume with gdisk (download required)  precodesudo gdisk /dev/disk0  Enter the following key sequence: N/Enter/Enter/Enter/AF00/W/Y Check the help with `?`! /code/pre/li liformat case-sensitive after getting the new device identifier  precodediskutil list sudo newfs_hfs -v dev -J -s disk0s4 #use the appropriate device identifier here /code/pre/li limodify volume permissions with chgrp/chmod if necessary/li liResult:  precode/dev/disk0 (internal, physical):   #:                       TYPE NAME                    SIZE           IDENTIFIER   0:      GUID_partition_scheme                        *500.3 GB       disk0   1:                        EFI EFI                     209.7 MB       disk0s1   2:          Apple_CoreStorage Macintosh HD            399.4 GB       disk0s2   3:                 Apple_Boot Recovery HD             650.0 MB       disk0s3   4:                  Apple_HFS dev                     100.0 GB       disk0s4         /dev/disk1 (internal, virtual):   #:                       TYPE NAME                    SIZE           IDENTIFIER   0:                  Apple_HFS Macintosh HD           +399.1 GB       disk1                          Logical Volume on disk0s2                          EFDB0B2F-EEBB-4CAC-8AFE-69F4C1803A5                          Unlocked Encrypted /code/pre/li /ul/li liCreate a growing sparsebundle:  precodehdiutil create -type SPARSEBUNDLE -size 100g -fs JHFS+X -volname dev dev /code/pre  Check codeman hdiutil/code for other formats like SPARSE etc./li /ol  hr  Scripting this is rather difficult but not impossible - except the last proposal which is easy to implement.  <comment349603> Are you executing the script as root?  Have you tried it from the Disk Utility app to see if it will even let you? <comment349605> When you say executing the script as root, does that mean appending a sudo to the command? If so, yes. I know it's possible because I can do it in disk utility, I just want to script it. <comment349614> What is the (notable) output of the following:   diskutil list;   diskutil coreStorage list; diskutil apfs list; <comment349616> Updated above with desired outputs <comment349617> What are you trying to achieve? "partitioning the Macintosh HD" is like baking an already baked and portioned piece of cake (disk1/Macintosh HD) or garnish millet flour (disk0s2/LVG/Macintosh HD) <comment349619> I need a case sensitive partition on my Macbook for my code, so I'm looking to partition off of Macintosh HD a dev partition for my code to live on. <comment349621> You cannot use the _verb_ `partitionDisk` when you've booted from the target of that _verb_! You'd have to boot from an external source, e.g. a macOS USB install flash drive in order to use `partitionDisk` on the internal disk. Read the man page for `diskutil`. <comment349625> You have two possibilities: you can resize the LV  EFDB0B2F-EEBB-4CAC-8AFE-69F4C1803A54 and create a second logical volume **in** the LVG. Or you can resize the whole LVG and create a fourth "normal" partition at the end of the disk - which one do you prefer? Each can be performed booted to your system volume. Do you want to encrypt the case-sensitive dev volume? <comment349630> Just wanted to note that my first comment "You cannot use the _verb_ `partitionDisk` ..." is just an FYI and not meant to tell you what you who do. You should do as klanomath suggests, he is extremely good with this type of scenario. <comment349852> I second the sparsebundle, especially for code.  Very easy to back up, to move to another machine, etc., without having to partition a drive.