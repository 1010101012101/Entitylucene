MacBook Air briefly wakes from sleep after 3 hours <body> My MacBook Air (a few months old) randomly wakes from sleep roughly 3 hours after the lid is closed. The wake reason is given as EC.LidOpen, but in fact, the lid remains closed. The mac appears to go immediately back to sleep. I am not experiencing any negative consequences from this, but wanted to be sure I shouldn't be worried about malware.  For example (this occurs every night)     log show --style syslog | fgrep "Wake reason"      2017-03-18 01:33:44.916848+0100  localhost kernel[0]: (AppleACPIPlatform) Wake reason: EC.SleepTimer (SleepTimer)      2017-03-18 04:33:58.836023+0100  localhost kernel[0]: (AppleACPIPlatform) Wake reason: EC.LidOpen (User)   emEDIT/em: using pmset -g log, I got more information on the mysterious wake-ups, which seem to be caused by mDNSResponder.     2017-04-14 10:23:12 +0200 Kernel Client Acks   Delays to Sleep notifications: [AppleBacklightDisplay driver is slow(msg: SetState to 0)(984 ms)] [powerd is slow(16830 ms)] [AppleThunderboltNHIType2 driver is slow(msg: WillChangeState to 2)(361 ms)] [RP03 driver is slow(msg: SetState to 0)(1277 ms)]br   2017-04-14 10:23:12 +0200 Assertions            PID 173(mDNSResponder) Created MaintenanceWake "mDNSResponder:maintenance" 00:00:00  id:0x0xd0000806d [System: DeclUser kDisp]br   2017-04-14 10:23:12 +0200 Assertions            PID 173(mDNSResponder) Released MaintenanceWake "mDNSResponder:maintenance" 00:00:00  id:0x0xd0000806d [System: DeclUser kDisp]br   2017-04-14 10:23:12 +0200 DarkWake              DarkWake from Deep Idle [CDN] due to EC.SleepTimer/SleepTimer: Using BATT (Charge:81%) 0 secsbr   2017-04-14 10:23:12 +0200 HibernateStats        hibmode=3 standbydelay=10800                                                          741br   2017-04-14 10:23:12 +0200 Kernel Client Acks    Delays to Wake notifications: [SSP3 driver is slow(msg: SetState to 3)(405 ms)] [SSP3 driver is slow(msg: DidChangeState to 3)(373 ms)]br   2017-04-14 10:23:12 +0200 Sleep                 Entering Sleep state due to 'Maintenance Sleep': Using Batt (Charge:81%) 1189 secs    2017-04-14 10:23:40 +0200 PM Client Acks        Delays to Sleep notifications: [AirPort configd plug-in is slow(1835 ms)] [com.apple.apsd timed out(28012 ms)]              strongEdit/strong:  precode energy saver preferences on battery: -turn display off after 15 minutes -put hard disks to sleep when possible -slightly dim the display when on battery power -(power nap unchecked)  Power adapter: -turn display off after 15 minutes -prevent computer from sleeping automatically when the display is off -put hard disks to sleep when possible -(wake for wi-fi network access unchecked) -(power nap unchecked) /code/pre  strongOne more edit:/strong Noticed the 10800 here is exactly 3 hours! Is that a coincidence? Does anybody know how to read/change these settings? This is in response to pmset -g  precodeSystem-wide power settings: Currently in use:  standbydelay         10800  standby              1  halfdim              1  hibernatefile        /var/vm/sleepimage  powernap             0  gpuswitch            2  disksleep            10  sleep                15 (sleep prevented by coreaudiod)  autopoweroffdelay    28800  hibernatemode        3  autopoweroff         1  ttyskeepawake        1  displaysleep         15  acwake               0  lidwake              1 /code/pre  <answer280678> It may be worth resetting your System Management Controller (SMC) to see if this resolves this behaviour.  To do this on your MacBook Air follow these steps:  ol liShut down your Mac/li liKeep the MagSafe adapter (power cable) strongplugged in/strong./li liPress at the same time kbdshift/kbdkbdoption/kbdkbdcontrol/kbd (on the strongleft/strong side of the strongbult-in/strong keyboard) strongemand/em/strong the kbdpower button/kbd/li liLet go/li liTurn your Mac back on with the power button./li /ol  Let me know how you go.  strongBoot into Safe Mode/strong  Since resetting the SMC didn't resolve this for you, I'd test to see if this still happens when booted into Safe Mode. To do this, follow these steps:  ol liFully shut down your Mac /li liRestart your Mac /li liImmediately press the kbdShift/kbd key and strongkeep it down/strong /li liLet go of the kbdShift/kbd key when you see the login window (NOTE: If you  have FileVault enabled you may need to log in twice). /li liTake a note of what happens (i.e. Close the lid and check again to see if it still wakes up 3hrs later) /li liExit Safe Mode by restarting your Mac as normal /li /ol  strongRun Apple Diagnostics/strong  Now that we've established Safe Mode makes no difference and resetting the SMC didn't help, it's time to test your Apple hardware. Your model of MacBook Air uses Apple Diagnostics to do this. Follow these steps:  ol liFully shut down your Mac/li liRestart your Mac/li liImmediately press the kbdD/kbd key and strongkeep it down/strong until you see the Diagnostics screen appear/li liWait for Diagnostics to finish (this typically only takes a few minutes)/li liOnce complete, one of two things will appear on the screen:  ul lia emNo issues found/em message/li lia brief description of any errors found plus further instructions/li /ul/li liIf the diagnostics test does find errors, take a note of what they are/li /ol  strongNote:/strong If pressing and holding the kbdD/kbd key at Step 3 doesn't work, start again at Step 1 and, at Step 3 press and hold both the kbdOption/kbdkbdD/kbd keys instead. This will try and run diagnostics from the internet instead, so you will need to allow more time for it to complete.   Regardless, take a note of what happens and let me know how you went.  <comment353025> Check to see if [Power Nap](https://support.apple.com/en-us/HT204032) is enabled. <comment353026> @IconDaemon currently disabled, should I turn it on? <comment353030> Thanks for the tip!  I've just reset the SMC; we'll see if the mac wakes up tonight or not. <comment353036> No. Enabling it would wake it from sleep. I was just wondering if Power Nap was the cause of the problem. It wouldn't hurt to enable Power Nap, close System Preferences, re-open System preferences then disable Power Nap. Sometimes making changes like this can fix a corrupted .plist file. The SMC reset was my next suggestion, but Monomeeth beat me to it. <comment353080> Didn't seem to work. 2017-04-14 00:56:47.400087+0200  localhost kernel[0]: (AppleACPIPlatform) Wake reason: EC.SleepTimer (SleepTimer) 2017-04-14 03:57:24.258265+0200  localhost kernel[0]: (AppleACPIPlatform) Wake reason: EC.LidOpen (User) <comment353081> I've just updated my answer to include steps for booting into Safe Mode. Try this and let me know how you go. <comment353100> thanks! It still woke up 3 hours later, even in Safe Mode. 2017-04-14 07:23:13.661906+0200  localhost kernel[0]: (AppleACPIPlatform) Wake reason: EC.SleepTimer (SleepTimer) 2017-04-14 10:23:47.385436+0200  localhost kernel[0]: (AppleACPIPlatform) Wake reason: EC.LidOpen (User) <comment353101> (I also tried the suggestion by @IconDaemon to toggle the status of Power Nap) <comment353108> Time to run Apple Diagnostics to test your Apple hardware. See my updated answer for instructions. <comment353111> No issues found! <comment353183> Just wondering, how did you _originally_ discover this issue? Also, can you update your question to include details of all your Energy Saver settings (for both AC power and Battery)? <comment353192> @Monomeeth happened to have system.log open about a month ago and noticed <comment353672> @Monomeeth see edit -- I think I found where "three hours" is coming from, although not how to fix it. Would be thrilled if you have any ideas! <comment353799> Well the 10800 value is fairly standard, but that doesn't mean it's not related to what's going on. Try changing the value by entering this command in the terminal: `sudo pmset -a standbydelay 3600` - this will change it to 60 mins (i.e. the 3600 seconds). Then test your MBA to see if the behaviour continues and, if so, whether it's at 3hrs or 1hr. By the way, I hadn't forgotten about this - I've been trying to replicate it on a machine here, but haven't been able to do so. It's not, however, something I think you need to be concerned about (if that makes you feel any better). :) <comment353875> @Monomeeth -- thanks ! You have certainly gone above and beyond the call of duty. I am not too worried anymore either since the behavior occurs in safe mode. Two new developments: 1) with your change, it is reawakening after an hour, as you predicted, and 2) I think it attempts to connect to wifi (At least, what it writes to wifi.log is different depending on whether it's in range of a network it knows or not). <comment353884> Okay, that's all to be expected. If you wanted, as another test, you could disconnect from the internet altogether prior to putting it to sleep to see whether it still reawakens. <comment354029> @Monomeeth if I disable wifi (just using "Turn Wifi Off" from the GUI) it still reconnects. Is there a way to turn off mDNSResponder as well? <comment354030> Sorry, I'm not sure what you mean by _it still reconnects_? Are you saying  your Mac's Wi-Fi doesn't stay disabled when you switch it off? Or do you mean something else? As for disabling mDNSResponder, enter the following command in terminal: `sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.mDNSResponder.plist`. To switch it back on use the exact same command except replace 'unload' with 'load'. <comment354048> @Monomeeth. Hi, sorry, I meant my computer still wakes up, not that it reconnects to the wifi. I'll try disabling mDNSresponder. <comment354107> @Monomeeth can't do it-- get "operation not permitted while System Integrity Protection is engaged."