How does one lock down OS X Server using the PF firewall? <body> Assume I have ip blocks for China, Russia, North Korea etc. How would I configure pf to allow those IP addresses to only access ports 80 and 443, and be denied access to other ports?   I have an instance of OS X Server 2.1.1 (aka Mountain Lion) running in a data center with a static ip address exposed to the internet. So there is no hardware firewalls etc to protect the server against malicious users.  Looking through the logs, I noticed numerous failed attempts from countries like China, Russia to services necessary for me to remotely manage the server. Further, I noticed that ports were unnecessarily open to the internet.  Since OS X 10.6 Snow Leopard Server, I used the Server Admin to manage the firewall (ipfw).  This has been removed in OS X Server 2.1.1 (Mountain Lion). And to make matters more interesting, the Apple documentation states that ipfw is deprecated and to use pf instead. Having read the man page, I'm a tad lost how to configure pf.   Googling "pf firewall tutorial" reveals tutorials aimed for NetBSD, FreeBSD and OpenBSD. Further filtering on "OS X" in that query reveals tutorials for "OS X", but it seems the authors assume some prior knowledge.    <answer69853> Try WaterRoof, it's IPFW with GUI: http://www.hanynet.com/waterroof/  <answer69857> Doesn't serveradmin in 10.8 allow you to load address groups from command line? Like, for example:   precode$ sudo serveradmin settings &lt; eu.txt /code/pre  eu.txt:  precodeipfilter:ipAddressGroupsWithRules:_array_id:eu = create ipfilter:ipAddressGroupsWithRules:_array_id:eu:allowAll = no ipfilter:ipAddressGroupsWithRules:_array_id:eu:readOnly = no ipfilter:ipAddressGroupsWithRules:_array_id:eu:name = "eu - Austria, Belgium, Croatia, Cyprus, Czech Republic, Denmark, European Union, Finland, France, Germany, Gibraltar, Greece, Holy See, Ireland, Italy, Luxembourg, Monaco, Netherlands, Norway, Poland, Slovakia, Slovenia, Spain, Sweden, Switzerland, United Kingdom" ipfilter:ipAddressGroupsWithRules:_array_id:eu:addresses:_array_index:0 = "192.168.100.0/16" ipfilter:ipAddressGroupsWithRules:_array_id:eu:addresses:_array_index:1 = "192.168.200.0/24" /code/pre  emEdit:/em  When codeserveradmin/code fails, use code/Applications/Server.app/Contents/ServerRoot/usr/sbin/serveradmin/code.  <answer69860> You should:  ol liunderstand pf basics - here is many guides on the Internet, you can safely read any Open/Free BSD guide. You must understand a few basic things:  ul liwith PF, last rule wins (opposite of IPFW's "first rule wins")/li lilogging is in the pflog device if the 'tcpdump' format/li licheck the codepfctl/code command using codeman pfctl/code/li lialso check codeman pf.conf/code/li liyou can create many simple text files that contains IP addresses (called tables) and using them in the filtering rules - see the example below./li /ul/li liAFTER this you can use two GUI frontends  ul liIceFloor (instead of the WaterRoof)/li liFirewall builder (cross platform)/li /ul/li /ol  PF is not too hard if you have some knowledge about how firewalling works in general.  Fragment of codepf.conf/code for table based filtering:  precodeinterface = "en0" allowed_ports = "{ 80, 443 }" table &lt;badips&gt; persist table &lt;noroute&gt; const { 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 } block in on $interface from { &lt;noroute&gt;, &lt;badips&gt; } to any pass in on $interface inet proto tcp from &lt;badips&gt; to $interface port $allowed_ports /code/pre  The above example contains:  ul lisome basic definitions, like your interface name and some ports/li lidefinition for two tables, codenoroute/code for nonroutable addresses (RFC 1918) and the second codebadips/code that can contain your Geo IP based IP addresses /li lifiltering rule - blocking anything from these tables/li liallowing ports 80 and 443 from codebadips/code (last rule wins)/li /ul  <comment81117> Your link to "Apple documentation" doesn't point to Apple, but to http://www.openbsd.org/faq/pf/ <comment81120> IPFW is deprecated, starting with Mountain Lion. <comment96726> What do the last two lines exactly mean? <comment96733> The last 2 lines are the IP addresses (network ranges in this case) that the group consists of. <comment96936> But these look like local IP addresses, not like addresses from europe? <comment96942> The IP addresses are just an anonymised example, replace them with your own ranges. For ranges, you might want to look them up at https://www.countryipblocks.net/ip_aggregation_beta.php <comment97048> Awesome. :) Thank you.