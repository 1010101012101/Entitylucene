Repair Time Machine sparsebundle that will no longer mount <body> I messed up my Time Machine backup in some way. I'm no longer able to mount the sparsebundle file as I get an error stating that there are no mountable filesystems.  I used the hdiutil command to attach the sparsebundle file:  precodehdiutil attach -nomount -readwrite flattop.sparsebundle /code/pre  which resulted in the following /dev/ devices:  precode/dev/disk2              Apple_partition_scheme /dev/disk2s1            Apple_partition_map /dev/disk2s2            Apple_HFSX /code/pre  Afterwards I ran the fsch_hfs command to check the main volume (/dev/disk2s2):  precodefsck_hfs -drf /dev/disk2s2 /code/pre  This resulted in a notice that the Time Machine Backups volume is corrupt and needed to be repaired:  precodeUnable to open block device /dev/disk2s2: Permission deniedjournal_replay(/dev/disk2s2) returned 13 ** /dev/rdisk2s2 (NO WRITE)     Using cacheBlockSize=32K cacheTotalBlock=32768 cacheSize=1048576K.    Executing fsck_hfs (version diskdev_cmds-540.1~34). Non-empty journal:  start = 66310144, end = 94912512    Journal need to be replayed but volume is read-only ** Checking Journaled HFS Plus volume. ** Detected a case-sensitive volume.    The volume name is Time Machine Backups ** Checking extents overflow file.    Unused node is not erased (node = 3568)    Unused node is not erased (node = 3574)    Unused node is not erased (node = 3575) ** Checking catalog file. ** The volume Time Machine Backups was found corrupt and needs to be repaired.     volume type is pure HFS+      primary MDB is at block 0 0x00      alternate MDB is at block 0 0x00      primary VHB is at block 2 0x02      alternate VHB is at block 2865568974 0xaacd1cce      sector size = 512 0x200      VolumeObject flags = 0x07      total sectors for volume = 2865568976 0xaacd1cd0      total sectors for embedded volume = 0 0x00  /code/pre  As you can see there is also an error saying "Unable to open block device /dev/disk2s2: Permission deniedjournal_replay(/dev/disk2s2) returned 13".  I thought this might be due to not running the fsck_hfs command as a su, so I tried it with sudo but this had the same result.  My sparsebundle file is on a Synology DS408 NAS and has been running without a problem for about 2 years now :(  Anyone an idea how to take this further?  Kind regards, Niels R.  UPDATE: As I suspected while writing this question I probably have a problem with read/write permissions. I now see the volume appearing in the Disk Utility and when I click on "Verify" I get the following output:  precodeVerifying volume “Time Machine Backups” Checking file systemJournal need to be replayed but volume is read-only Checking Journaled HFS Plus volume. Detected a case-sensitive volume. Checking extents overflow file. Unused node is not erased (node = 3568) Checking catalog file. Keys out of order The volume Time Machine Backups was found corrupt and needs to be repaired. Error: This disk needs to be repaired. Click Repair Disk. /code/pre  Can I simply chmod the sparsebundle file to set the right permissions?  <answer23395> Extended attributes on the sparsebundle may be preventing writes on the file:  Run  precodechflags -R nouchg flattop.sparsebundle /code/pre  But be careful, the sparsebundle may have been protected because it genuinely is broken.  <answer26120> It's not that simple as chmod. First, it emappears/em that 10.5 / 10.6 / 10.7 all have minor differences in how a sparse bundle is handled. Second, the flags and dirty/bad status of a sparse bundle are stored elsewhere. Third, you may need to attack the sparse bundle itself - not the filesystem that is contained within.  Your best bet is to let Disk Utility take a crack at repairing the image before you look at the filesystem embedded within. It works on both the bundle and the filesystems - as well as knows how Apple has stored things.   The details of the bundle are either proprietary or hard to discern from the developer docs - and it's certainly not something other third party utilities are keen to fix at this point. As long as you are using an equal or newer version of Disk Utility than the mac that made the backups, you should be fine. Once you've given up on Disk Utility - you might try something like Drive Genius or Disk Warrior - but I'd stick with Apple's tool if you hope to reuse this bundle.  The nature of sparse bundles - specifically the hard links as well as the concept that it's not compacted when files are deleted, there is a strongemlot of work to be done/em/strong. I have had DiskUtility run for two weeks and still not complete a repair pass on a 800MB sized archive.  In practice, you might be better off just reverting to a prior version of your NAS if it has snapshots or is backed up itself. In the end - if there are errors that fsck/Disk Utility can't fix, your sparse bundle will be marked as bad and it will be locked. You can then read things, but never write to it again. Do see if you can connect a machine to the storage and fix things (DAS or high speed connections are better - as is a machine that can have the time to fix things and not get rebooted is ideal)   Best of luck - this may not be recoverable from the details you provided.  <answer39842> I have a write up on how to try and repair NAS-based sparsebundle errors on my blog.  In summary:  ol licodehdiutil attach -nomount -noverify -noautofsck /Volumes/{name of your disk}/{name of}.sparsebundle/code  You will then see something like  precode/dev/diskx Apple_partition_scheme /dev/diskxs1 Apple_partition_map /dev/diskxs2 Apple_HFSX /code/pre  Where emx/em is the disk id for the external disk. You are interested in the one labeled Apple_HFSX or Apple_HFS. It might be 2, 3, 4 or higher./li licodefsck_hfs -drfy /dev/diskxs2/code using whatever relevant device was located in Step 1.  Hopefully, you will eventually see     The Volume was repaired successfully /li licodehdiutil detach /dev/diskxs2/code/li /ol  hr  However, since OS X 10.6.3, Time Machine will refuse to write to a destination volume that fails its verification.  Even if the process above succeeds in recovering the backup, you may still need to remove the black marks that Time Machine wrote when it failed verification.  ol start="4" liUnlock the sparsebundle  precodechflags -R nouchg /Volumes/{name of your disk}/{name of}.sparsebundle /code/pre/li liMove it back to its original location  precodemv /Volumes/{name of your disk}/{name of}_YYYY-MM-DD.sparsebundle /Volumes/{name of your disk}/{name of}.sparsebundle /code/pre/li liAt the top level directory of the sparsebundle, edit the file codecom.apple.TimeMachine.MachineID.plist/code.  ul liRemove  precode&lt;key&gt;RecoveryBackupDeclinedDate&lt;/key&gt; &lt;date&gt;{whatever-the-date}&lt;/date&gt; /code/pre/li liChange  precode&lt;key&gt;VerificationState&lt;/key&gt; &lt;integer&gt;2&lt;/integer&gt; /code/pre  to  precode&lt;key&gt;VerificationState&lt;/key&gt; &lt;integer&gt;0&lt;/integer&gt; /code/pre/li /ul/li /ol  <answer82458> I just had the same problem  precode** /dev/rdisk2s2 (NO WRITE) /code/pre  when trying to fix a currupted TM-sparsebundle on a QNAP 419II.  I "ejected" the TM-mount using Finder and run  precodehdiutil attach -nomount -noverify -noautofsck ... /code/pre  command (found here Fix Time Machine Sparsebundle NAS Based Backup Errors) again, which (in contrary to the first run with which it printed "/dev/disk2s2   Apple_HFSX") this time it gave  precode/dev/disk1s2            Apple_HFSX   /code/pre  Checking the sys-log with  precodetail -f /var/log/fsck_hfs.log /code/pre  No showed  precode/dev/rdisk1s2: fsck_hfs run at Sun Feb 17 17:53:20 2013 /dev/rdisk1s2: ** /dev/rdisk1s2 /dev/rdisk1s2:    Executing fsck_hfs (version diskdev_cmds-540.1~34). ** Checking Journaled HFS Plus volume. ** Detected a case-sensitive volume. ... LOTS-OF-OUTPUT ... QUICKCHECK ONLY; FILESYSTEM CLEAN /code/pre  Never the less, re-activating TM still resulted in currepted-backup-message :(  Good luck!  <answer140011> I have a Syology NAS and was getting  the NO-WRITE error when trying to run the fix but i came across this tweaked version that saved my bacon.   http://tonylawrence.com/blog/2012/08/11/fixing-corrupted-time-machine-backups/  <answer151916> If you back up a sparse bundle disk image on one machine and try to open it on another you may get the "no mountable filesystems" error message, especially if the owners' usernames differ between the two machines.  My solution was copying the bundle to my local disk and running  codesudo chown -R MyUserName nonmounting.sparsebundle/code  on it.  After that it opened fine and all was right with the world.  <comment164982> Welcome to Ask Different! While this link may answer the question, it is better to include the essential parts of the answer here and provide the link for reference. Link-only answers can become invalid if the linked page changes. <comment273870> The call to `fsck_hfs` returns: Unable to open block device /dev/disk7s2: Resource busyjournal_replay(/dev/disk7s2) returned 16 <comment301309> If it genuinely is broken, is there anything to lose?  It's my understanding that the only other option is to wipe it and start a new backup. <comment318253> fsck_hfs -drfy /dev/disk2s2 Unable to open block device /dev/disk2s2: Permission deniedjournal_replay(/dev/disk2s2) returned 13 ** /dev/rdisk2s2 (NO WRITE) <comment318312> I also was getting no-write, these were the only instructions that worked for me and I tried all the others. <comment318313> These instructions didn't work for me but Christian L's link did the trick. <comment330722> This solved the problem for me, thanks! Here's the output from running the commands (to make it more searchable) https://gist.github.com/oleander/d3d37a46940d0ac4b538da62e0745601 Pro tip: **don't run the above commands over Wi-Fi** (802.11n, 200Gb). Tried it first and had to abort after 30h+. Ended up using an ethernet cable, which "only" took 2h. <comment355124> If fsck_hfs says cannot repair try diskutil repairVolume /dev/disk2s2 <comment358310> This worked for me, thanks!