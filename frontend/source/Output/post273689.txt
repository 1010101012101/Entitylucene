Bootcamp classics - win7 part dissapeared after resizing OSX part in DiskUtil, Yosemite 10.10.2 <body> Good day!  mid 2012 rMBP 500GB SSD, OSX 10.10.2, Bootcamp, SSD structure bottom-up:   WIN 7 on 40gb (approx),  unallocated space about 10 GB,  I did resize 450GB-410GB with Disk Utility in OSX, so unallocated space became about 40GB.   I was about to add some space to Win and install Proxmox in the rest of 10+40GB new unallocated space. I booted Proxmox USB and install hangs on CD-ROM search, did not work, then restart and soon I found Win vanished from boot options, and even if I boot to Win To Go USB, Disk Management (now, after all the things done) show it as Active, Primary but RAW.   I did research and first found simplified method, were I think (not sure exactly) I just deleted partition 4 and then recreated it, at that point I was just a monkey and did not understood what I was doing, then I found very similar case and followed it carefully: Boot Camp partition broken and can&#39;t be repaired in OS X 10.10.4  TestDisk, gdisk, diskpart, Win7 restore, but no luck: Missing Operating System on boot. TestDisk deep scan shows huge mess: 1tb SSD (while it's 500GB) and million deleted fragments.   Some codesudo gpt -r -vv show /dev/rdisk0/code from terminal, before doing the latter method:  precodegpt show: /dev/rdisk0: mediasize=500277790720; sectorsize=512; blocks=977105060 gpt show: /dev/rdisk0: Suspicious MBR at sector 0 gpt show: /dev/rdisk0: Pri GPT at sector 1 gpt show: /dev/rdisk0: Sec GPT at sector 977105059       start       size  index  contents           0          1         MBR           1          1         Pri GPT header           2         32         Pri GPT table          34          6                   40     409600      1  GPT part - C12A7328-F81F-11D2-BA4B-00A0C93EC93B      409640  800195720      2  GPT part - 48465300-0000-11AA-AA11-00306543ECAC   800605360    1269536      3  GPT part - 426F6F74-0000-11AA-AA11-00306543ECAC   801874896   97106992            898981888   78123008      4  GPT part - EBD0A0A2-B9E5-4433-87C0-68B6B72699C7   977104896        131            977105027         32         Sec GPT table   977105059          1         Sec GPT header /code/pre  Then some TestDisk quick scan:  precodeDisk /dev/disk0 - 500 GB / 465 GiB - 977105060 sectors (RO)  The harddisk (500 GB / 465 GiB) seems too small! (&lt; 858 GB / 799 GiB) Check the harddisk size: HD jumpers settings, BIOS detection...  The following partitions can't be recovered:      Partition               Start        End    Size in sectors &gt;  Mac HFS                876721716 1676917435  800195720    MS Data                977104895 1076217847   99112953    Mac HFS                977105020  978374555    1269536  [ Continue ] HFS+ blocksize=4096, 409 GB / 381 GiB   Disk /dev/disk0 - 500 GB / 465 GiB - 977105060 sectors (RO)      Partition               Start        End    Size in sectors &gt;P EFI System                    40     409639     409600 [EFI]  D Mac HFS                   409640  800605359  800195720  D Mac HFS                 76526000  876721719  800195720  D MS Data                778878984  877991936   99112953  D Mac HFS                800605360  801874895    1269536  D Mac HFS                876721720  877991255    1269536  D MS Data                877991936  977104888   99112953  D MS Data                877991943  977104895   99112953  D Mac HFS                975835488  977105023    1269536    Structure: Ok.  Use Up/Down Arrow keys to select partition. Use Left/Right Arrow keys to CHANGE partition characteristics:                 P=Primary  D=Deleted Keys A: add partition, L: load backup, T: change type, P: list files,      Enter: to continue FAT32, blocksize=512, 209 MB / 200 MiB   Disk /dev/disk0 - 500 GB / 465 GiB - 977105060 sectors (RO) Current partition structure:      Partition                  Start        End    Size in sectors   1 P EFI System                    40     409639     409600 [EFI system partition]  2 P Mac HFS                   409640  800605359  800195720 [Customer]  3 P Mac Boot               800605360  801874895    1269536 [Recovery HD] No FAT, NTFS, ext2, JFS, Reiser, cramfs or XFS marker  4 P MS Data                898981888  977104895   78123008 [BOOTCAMP]  4 P MS Data                898981888  977104895   78123008 [BOOTCAMP]                   P=Primary  D=Deleted /code/pre  Then it shows even more (not the deepest scan yet), including some more detailed info on each partition found the bottom of the screen (may be I should use this info in the following commands?):  precodeDisk /dev/disk0 - 500 GB / 465 GiB - 977105060 sectors (RO)  The harddisk (500 GB / 465 GiB) seems too small! (&lt; 1169 GB / 1089 GiB) Check the harddisk size: HD jumpers settings, BIOS detection...  The following partitions can't be recovered:      Partition               Start        End    Size in sectors &gt;  Mac HFS                139735816 2285070676 2145334861 [~C^^LP]    Mac HFS                800605356 1600801075  800195720    Mac HFS                876721716 1676917435  800195720    MS Data                915255616  993378623   78123008    MS Data                960145447 1012147788   52002342 [SYSTEM]    MS Data                977104888 1076217840   99112953    MS Data                977104895 1076217847   99112953    Mac HFS                977105020  978374555    1269536    [ Continue ] HFS blocksize=16777216, 1098 GB / 1022 GiB HFS+ blocksize=4096, 409 GB / 381 GiB HFS+ blocksize=4096, 409 GB / 381 GiB NTFS, blocksize=4096, 39 GB / 37 GiB NTFS, blocksize=4096, 39 GB / 37 GiB FAT32, blocksize=8192, 26 GB / 24 GiB NTFS, blocksize=4096, 50 GB / 47 GiB NTFS, blocksize=4096, 50 GB / 47 GiB HFS+ blocksize=4096, 650 MB / 619 MiB /code/pre  On a Deep Scan it showed million of small deleted partitions and I was not able to find any of my interest...  Then I did following, but using "standard regions" from diskutil, not the ones from TestDisk (is it was THE mistake???) as those was confusing and code-p/code (show files) did not work due to something like codeSupport for this file system was not compiled/code error (I installed TestDisk from http://macappstore.org/testdisk/), and diskutil showed some reasonably looking data:  precodediskutil list /dev/disk0    #:                       TYPE NAME                    SIZE       IDENTIFIER    0:      GUID_partition_scheme                        *500.3 GB   disk0    1:                        EFI EFI                     209.7 MB   disk0s1    2:                  Apple_HFS Macintosh HD            409.7 GB   disk0s2    3:                 Apple_Boot Recovery HD             650.0 MB   disk0s3    4:       Microsoft Basic Data                         40.0 GB    disk0s4 akpro:~ idEC$ sudo gpt -r -vv show /dev/rdisk0 Password: gpt show: /dev/rdisk0: mediasize=500277790720; sectorsize=512; blocks=977105060 gpt show: /dev/rdisk0: Suspicious MBR at sector 0 gpt show: /dev/rdisk0: Pri GPT at sector 1 gpt show: /dev/rdisk0: Sec GPT at sector 977105059       start       size  index  contents           0          1         MBR           1          1         Pri GPT header           2         32         Pri GPT table          34          6                   40     409600      1  GPT part - C12A7328-F81F-11D2-BA4B-00A0C93EC93B      409640  800195720      2  GPT part - 48465300-0000-11AA-AA11-00306543ECAC   800605360    1269536      3  GPT part - 426F6F74-0000-11AA-AA11-00306543ECAC   801874896   97106992            898981888   78123008      4  GPT part - EBD0A0A2-B9E5-4433-87C0-68B6B72699C7   977104896        131            977105027         32         Sec GPT table   977105059          1         Sec GPT header akpro:~ idEC$ sudo fdisk -e /dev/disk0 fdisk: could not open MBR file /usr/standalone/i386/boot0: No such file or directory Enter 'help' for information fdisk: 1&gt; ^Cakpro:~ idEC$          akpro:~ idEC$ sudo fdisk /dev/disk0 Disk: /dev/disk0    geometry: 60821/255/63 [977105060 sectors] Signature: 0xAA55          Starting       Ending  #: id  cyl  hd sec -  cyl  hd sec [     start -       size] ------------------------------------------------------------------------  1: EE 1023 254  63 - 1023 254  63 [         1 -     409639] &lt;Unknown ID&gt;  2: AF 1023 254  63 - 1023 254  63 [    409640 -  800195720] HFS+          3: AB 1023 254  63 - 1023 254  63 [ 800605360 -    1269536] Darwin Boot  *4: 07 1023 254  63 - 1023 254  63 [ 898981888 -   78123008] HPFS/QNX/AUX akpro:~ idEC$ sudo gpt -r -vv show /dev/rdisk0 gpt show: /dev/rdisk0: mediasize=500277790720; sectorsize=512; blocks=977105060 gpt show: /dev/rdisk0: Suspicious MBR at sector 0 gpt show: /dev/rdisk0: Pri GPT at sector 1 gpt show: /dev/rdisk0: Sec GPT at sector 977105059       start       size  index  contents           0          1         MBR           1          1         Pri GPT header           2         32         Pri GPT table          34          6                   40     409600      1  GPT part - C12A7328-F81F-11D2-BA4B-00A0C93EC93B      409640  800195720      2  GPT part - 48465300-0000-11AA-AA11-00306543ECAC   800605360    1269536      3  GPT part - 426F6F74-0000-11AA-AA11-00306543ECAC   801874896   97106992            898981888   78123008      4  GPT part - EBD0A0A2-B9E5-4433-87C0-68B6B72699C7   977104896        131            977105027         32         Sec GPT table   977105059          1         Sec GPT header akpro:~ idEC$ sudo gdisk /dev/rdisk0 Password: GPT fdisk (gdisk) version 1.0.1  Warning: Devices opened with shared lock will not have their partition table automatically reloaded! Partition table scan:   MBR: hybrid   BSD: not present   APM: not present   GPT: present  Found valid GPT with hybrid MBR; using GPT.  Command (? for help): p Disk /dev/rdisk0: 977105060 sectors, 465.9 GiB Logical sector size: 512 bytes Disk identifier (GUID): 000007FF-41E8-0000-3D34-0000C4440000 Partition table holds up to 128 entries First usable sector is 34, last usable sector is 977105026 Partitions will be aligned on 8-sector boundaries Total free space is 97107129 sectors (46.3 GiB)  Number  Start (sector)    End (sector)  Size       Code  Name    1              40          409639   200.0 MiB   EF00  EFI system partition    2          409640       800605359   381.6 GiB   AF00  Customer    3       800605360       801874895   619.9 MiB   AB00  Recovery HD    4       898981888       977104895   37.3 GiB    0700  BOOTCAMP  Command (? for help): d Partition number (1-4): 4  Command (? for help): n Partition number (4-128, default 4): 4 First sector (34-977105026, default = 801874896) or {+-}size{KMGTP}:898981888 ^ Last sector (898981888-977105026, default = 977105026) or {+-}size{KMGTP}:+78123008 Current type is 'Apple HFS/HFS+' Hex code or GUID (L to show codes, Enter = AF00): 0700 Changed type of partition to 'Microsoft basic data'  Command (? for help): p Disk /dev/rdisk0: 977105060 sectors, 465.9 GiB Logical sector size: 512 bytes Disk identifier (GUID): 000007FF-41E8-0000-3D34-0000C4440000 Partition table holds up to 128 entries First usable sector is 34, last usable sector is 977105026 Partitions will be aligned on 8-sector boundaries Total free space is 97107129 sectors (46.3 GiB)  Number  Start (sector)    End (sector)  Size       Code  Name    1              40          409639   200.0 MiB   EF00  EFI system partition    2          409640       800605359   381.6 GiB   AF00  Customer    3       800605360       801874895   619.9 MiB   AB00  Recovery HD    4       898981888       977104895   37.3 GiB    0700  Microsoft basic data  Command (? for help): w  Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING PARTITIONS!!  Do you want to proceed? (Y/N): y OK; writing new GUID partition table (GPT) to /dev/rdisk0. Warning: Devices opened with shared lock will not have their partition table automatically reloaded! Warning: The kernel may continue to use old or deleted partitions. You should reboot or remove the drive. The operation has completed successfully. akpro:~ idEC$ sudo gdisk /dev/rdisk0 Password: GPT fdisk (gdisk) version 1.0.1  Warning: Devices opened with shared lock will not have their partition table automatically reloaded! Partition table scan:   MBR: hybrid   BSD: not present   APM: not present   GPT: present  Found valid GPT with hybrid MBR; using GPT.  Command (? for help): p Disk /dev/rdisk0: 977105060 sectors, 465.9 GiB Logical sector size: 512 bytes Disk identifier (GUID): 000007FF-41E8-0000-3D34-0000C4440000 Partition table holds up to 128 entries First usable sector is 34, last usable sector is 977105026 Partitions will be aligned on 8-sector boundaries Total free space is 97107129 sectors (46.3 GiB)  Number  Start (sector)    End (sector)  Size       Code  Name    1              40          409639   200.0 MiB   EF00  EFI system partition    2          409640       800605359   381.6 GiB   AF00  Customer    3       800605360       801874895   619.9 MiB   AB00  Recovery HD    4       898981888       977104895   37.3 GiB    0700  Microsoft basic data  Command (? for help): r  Recovery/transformation command (? for help): o  Disk size is 977105060 sectors (465.9 GiB) MBR disk identifier: 0x02DE5AA7 MBR partitions:  Number  Boot  Start Sector   End Sector   Status      Code    1                     1       409639   primary     0xEE    2                409640    800605359   primary     0xAF    3             800605360    801874895   primary     0xAB  Recovery/transformation command (? for help): h  WARNING! Hybrid MBRs are flaky and dangerous! If you decide not to use one, just hit the Enter key at the below prompt and your MBR partition table will be untouched.  Type from one to three GPT partition numbers, separated by spaces, to be added to the hybrid MBR, in sequence: 2 3 4 Place EFI GPT (0xEE) partition first in MBR (good for GRUB)? (Y/N): y  Creating entry for GPT partition #2 (MBR partition #2) Enter an MBR hex code (default AF): n Set the bootable flag? (Y/N): n  Creating entry for GPT partition #3 (MBR partition #3) Enter an MBR hex code (default AB): n Set the bootable flag? (Y/N): n  Creating entry for GPT partition #4 (MBR partition #4) Enter an MBR hex code (default 07):  Set the bootable flag? (Y/N): y  Recovery/transformation command (? for help): o  Disk size is 977105060 sectors (465.9 GiB) MBR disk identifier: 0x02DE5AA7 MBR partitions:  Number  Boot  Start Sector   End Sector   Status      Code    1                     1       409639   primary     0xEE    2                409640    800605359   primary     0x01    3             800605360    801874895   primary     0x01    4      *      898981888    977104895   primary     0x07  Recovery/transformation command (? for help): ^Cakpro:~ idEC$ sudo gdisk /dev/rdisk0 Password: GPT fdisk (gdisk) version 1.0.1  Warning: Devices opened with shared lock will not have their partition table automatically reloaded! Partition table scan:   MBR: hybrid   BSD: not present   APM: not present   GPT: present  Found valid GPT with hybrid MBR; using GPT.  Command (? for help): p Disk /dev/rdisk0: 977105060 sectors, 465.9 GiB Logical sector size: 512 bytes Disk identifier (GUID): 000007FF-41E8-0000-3D34-0000C4440000 Partition table holds up to 128 entries First usable sector is 34, last usable sector is 977105026 Partitions will be aligned on 8-sector boundaries Total free space is 97107129 sectors (46.3 GiB)  Number  Start (sector)    End (sector)  Size       Code  Name    1              40          409639   200.0 MiB   EF00  EFI system partition    2          409640       800605359   381.6 GiB   AF00  Customer    3       800605360       801874895   619.9 MiB   AB00  Recovery HD    4       898981888       977104895   37.3 GiB    0700  Microsoft basic data  Command (? for help): r  Recovery/transformation command (? for help): o  Disk size is 977105060 sectors (465.9 GiB) MBR disk identifier: 0x02DE5AA7 MBR partitions:  Number  Boot  Start Sector   End Sector   Status      Code    1                     1       409639   primary     0xEE    2                409640    800605359   primary     0xAF    3             800605360    801874895   primary     0xAB  Recovery/transformation command (? for help): h  WARNING! Hybrid MBRs are flaky and dangerous! If you decide not to use one, just hit the Enter key at the below prompt and your MBR partition table will be untouched.  Type from one to three GPT partition numbers, separated by spaces, to be added to the hybrid MBR, in sequence: 2 3 4 Place EFI GPT (0xEE) partition first in MBR (good for GRUB)? (Y/N): y  Creating entry for GPT partition #2 (MBR partition #2) Enter an MBR hex code (default AF):  Set the bootable flag? (Y/N): n  Creating entry for GPT partition #3 (MBR partition #3) Enter an MBR hex code (default AB):  Set the bootable flag? (Y/N): n  Creating entry for GPT partition #4 (MBR partition #4) Enter an MBR hex code (default 07):  Set the bootable flag? (Y/N): y  Recovery/transformation command (? for help): o  Disk size is 977105060 sectors (465.9 GiB) MBR disk identifier: 0x02DE5AA7 MBR partitions:  Number  Boot  Start Sector   End Sector   Status      Code    1                     1       409639   primary     0xEE    2                409640    800605359   primary     0xAF    3             800605360    801874895   primary     0xAB    4      *      898981888    977104895   primary     0x07  Recovery/transformation command (? for help): w  Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING PARTITIONS!!  Do you want to proceed? (Y/N): y OK; writing new GUID partition table (GPT) to /dev/rdisk0. Warning: Devices opened with shared lock will not have their partition table automatically reloaded! Warning: The kernel may continue to use old or deleted partitions. You should reboot or remove the drive. The operation has completed successfully. /code/pre  Now, after all it looks like this:  precodesudo fdisk /dev/disk0   Disk: /dev/disk0    geometry: 60821/255/63 [977105060 sectors] Signature: 0xAA55          Starting       Ending  #: id  cyl  hd sec -  cyl  hd sec [     start -       size] ------------------------------------------------------------------------  1: EE    0   0   2 -   25 127  14 [         1 -     409639] &lt;Unknown ID&gt;  2: AF   25 127  15 - 1023 254  63 [    409640 -  800195720] HFS+          3: AB 1023 254  63 - 1023 254  63 [ 800605360 -    1269536] Darwin Boot  *4: 07 1023 254  63 - 1023 254  63 [ 898981888 -   78123008] HPFS/QNX/AUX /code/pre  and codesudo gpt -r -vv show /dev/rdisk0/code  precodegpt show: /dev/rdisk0: mediasize=500277790720; sectorsize=512; blocks=977105060 gpt show: /dev/rdisk0: Suspicious MBR at sector 0 gpt show: /dev/rdisk0: Pri GPT at sector 1 gpt show: /dev/rdisk0: Sec GPT at sector 977105059       start       size  index  contents           0          1         MBR           1          1         Pri GPT header           2         32         Pri GPT table          34          6                   40     409600      1  GPT part - C12A7328-F81F-11D2-BA4B-00A0C93EC93B      409640  800195720      2  GPT part - 48465300-0000-11AA-AA11-00306543ECAC   800605360    1269536      3  GPT part - 426F6F74-0000-11AA-AA11-00306543ECAC   801874896   97106992            898981888   78123008      4  GPT part - EBD0A0A2-B9E5-4433-87C0-68B6B72699C7   977104896        131            977105027         32         Sec GPT table   977105059          1         Sec GPT header /code/pre  What I need is to restore somehow Win7 or at least take out some files  <comment344064> You must use OS X tools to create the partitions in the first place to ensure that the tools know the space is used.  You may want to install Windows first using boot camp and then overwrite with your alternative operating system. <comment344075> Seems there is not much options in Bootcamp, how to add a 3rd (2nd Win) partition from there please? link? How to resize existent Win partition from Bootcamp without reinstalling Win?  thnx <comment344077> Also I did use OSX tools - Disk Utility to resize, then I was not able to do anything with unallocated space, not from Proxmox (it did not boot from USB), not from Win (it's vanished). Sorry, but your suggestion is not relevant yet. Please provide more information. Also it is know issue - Bootcamp VS Diskutil did not match... <comment344091> I was assuming you only wanted a single non-Windows operating system in addition to OS X.   Boot camp does not help much after installation when resizing.  You can shrink the OS X partition leaving extra space for Windows.  Windows itself has some tooling for resizing file systems inside disk partitions, but you might want better support.  I believe https://www.paragon-software.com/da/home/hdm-mac/ can give you that.  They also have cross platform file system drivers.  Personally I have stopped doing that - nothing beats IMHO OS X on Apple hardware. <comment344183> Yes you right, but I need to test and may be use on same machine hypervisor type 1 (bare metal) and direct assign (pass-through), which suppose to work on this hardware or at least resize partition to give WIn more space. Unfortunately OSX Hypervisor seems to be Type 2 and too new project. <comment344213> Put an extra drive in the computer. SD-cards or USB and only have one system per physical drive.