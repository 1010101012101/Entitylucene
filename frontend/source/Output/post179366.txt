Configure Yosemite Server WebApp with LaunchD <body> h2Question/h2  Has anyone successfully been able to start a webapp via a codewebappctl/code configuration which specifies a launchd configuration in their codewebapp.plist/code codelaunchKeys/code key?  h2Background/h2  Specifically, with Server.app installed, one can, in theory, configure custom web applications which would show up in the Server.app GUI under the "Advanced Settings" of a Website configuration.  If you take a look at the codeReadMe.txt/code in code/Library/Server/Web/Config/apache2/code there's a section which states:  precodewebapps/  This directory contains the webapp.plist files for all defined webapps. See the man page for webapp.plist(8) and webappctl(8). (Server app man pages are present in /Applications/Server.app/Contents/ServerRoot/usr/share/man/.)  Administrators are strongly encouraged to use the webapp mechanism instead of modifying virtual host config files directly. In general, you can place Apache configuration directives in an "Include" file, and create a webapp.plist file that references that Include file. You can then activate or de-activate that Include file for the default sites, or for specific custom sites, by using webappctl(8). /code/pre  You can also read the man entries, as suggested in the ReadMe.txt by these terminal commands:  precodeman -M /Applications/Server.app/Contents/ServerRoot/usr/share/man/ webapp.plist man -M /Applications/Server.app/Contents/ServerRoot/usr/share/man/ webappctl /code/pre  There's also a sample webapp configuration code/Library/Server/Web/Config/apache2/com.example.mywebapp.plist/code which has some comments in it about how this plist could be configured.  h2Setup/h2  In my case I have added a codewebapp.plist/code to the code/Library/Server/Web/Config/apache2//code directory which looks like this:  precode&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;  &lt;!-- See man pages for webapp.plist(5) and webappctl(8) for information about webapp.plist --&gt;  &lt;plist version="1.0"&gt; &lt;dict&gt;   &lt;key&gt;includeFiles&lt;/key&gt;     &lt;array/&gt; &lt;!-- Include files are activated in virtual host when webapp is started --&gt;   &lt;key&gt;launchKeys&lt;/key&gt;     &lt;array&gt; &lt;!-- Launchd plists in /Applications/Server.app/Contents/ServerRoot/System/Library/LaunchDaemons are loaded when webapp is started --&gt;       &lt;string&gt;org.levi.foo&lt;/string&gt;     &lt;/array&gt;   &lt;key&gt;name&lt;/key&gt;     &lt;string&gt;org.apache.tomcat&lt;/string&gt;   &lt;key&gt;displayName&lt;/key&gt; &lt;!-- Name shown in Server app --&gt;     &lt;string&gt;Tomcat&lt;/string&gt;   &lt;key&gt;proxies&lt;/key&gt; &lt;!-- ProxyPass/ProxyPassReverse directives are activated when webapp is started --&gt;     &lt;dict/&gt;   &lt;key&gt;requiredModuleNames&lt;/key&gt;     &lt;array/&gt;   &lt;key&gt;installationIndicatorFilePath&lt;/key&gt; &lt;!-- The presence of this file indicates web app is installed --&gt;     &lt;string&gt;/Library/Tomcat/Home/bin/catalina.sh&lt;/string&gt;   &lt;key&gt;sslPolicy&lt;/key&gt; &lt;!-- Determines webapp SSL behavior --&gt;     &lt;integer&gt;0&lt;/integer&gt; &lt;!-- 0: default, UseSSLWhenEnabled --&gt;   &lt;!-- 1: UseSSLAlways --&gt;   &lt;!-- 2: UseSSLOnlyWhenCertificateIsTrustable --&gt;   &lt;!-- 3: UseSSLNever --&gt;   &lt;!-- 4: UseSSLAndNonSSL --&gt; &lt;/dict&gt; &lt;/plist&gt; /code/pre  Paying specific attention to:  precode&lt;key&gt;launchKeys&lt;/key&gt;   &lt;array&gt;   &lt;string&gt;org.levi.foo&lt;/string&gt; &lt;/array&gt; /code/pre  which specifies my codelaunchd.plist/code which is located at code/Applications/Server.app/Contents/ServerRoot/System/Library/LaunchDaemons/org.levi.foo.plist/code and looks like:  precode&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt; &lt;plist version="1.0"&gt; &lt;dict&gt;   &lt;key&gt;Label&lt;/key&gt;     &lt;string&gt;org.levi.foo&lt;/string&gt;       &lt;key&gt;RunAtLoad&lt;/key&gt;         &lt;true/&gt; &lt;key&gt;Program&lt;/key&gt;     &lt;string&gt;/Library/Tomcat/start.sh&lt;/string&gt; &lt;/dict&gt; &lt;/plist&gt; /code/pre  which should simply call the script code/Library/Tomcat/start.sh/code which is simply:  precode#!/bin/bash  BASENAME=`basename $0` LOGGER_B="/usr/bin/logger"  function log {   MESSAGE="$1"   ${LOGGER_B} -i -p daemon.notice -t ${BASENAME} ${MESSAGE} }  log "Here I am!" /code/pre  h2Issue/h2  If I use codelaunchctl/code to manually load the codeorg.levi.foo.plist/code:  precode$ sudo launchctl load org.levi.foo.plist /code/pre  I get the expected message in code/var/log/system.log/code:  precodeApr  2 16:12:01 host sudo[85791]:     levi : TTY=ttys000 ; PWD=/Applications/Server.app/Contents/ServerRoot/System/Library/LaunchDaemons ; USER=root ; COMMAND=/bin/launchctl load org.levi.foo.plist Apr  2 16:12:01 host start.sh[85795]: Here I am! /code/pre  However, if I use codewebappctl/code to start my webapp configuration (above):  precode$ sudo webappctl start org.apache.tomcat /code/pre  I get an error in code/var/log/system.log/code:  precodeApr  2 16:18:46 host sudo[85904]:     levi : TTY=ttys000 ; PWD=/Applications/Server.app/Contents/ServerRoot/System/Library/LaunchDaemons ; USER=root ; COMMAND=/Applications/Server.app/Contents/ServerRoot/usr/sbin/webappctl start org.apache.tomcat Apr  2 16:18:47 host serverctl[85914]: ERROR: The operation couldn’t be completed. Operation not permitted Apr  2 16:18:49 host serverctl[85915]: ERROR: The operation couldn’t be completed. Operation not permitted Apr  2 16:18:49 host servermgr_web[85908]: XSWebConfig:ERROR: Failed on second attempt to load /Applications/Server.app/Contents/ServerRoot/System/Library/LaunchDaemons/org.levi.foo.plist /code/pre  and I don't see my "Here I am!" message.  This seems to indicate that my codelaunchd.plist/code is not making it as far as running the script when trying to start via codewebappctl/code, but I have no idea what operation couldn't be completed, or why not. All of the files I've mentioned are owned by coderoot:wheel/code with coderw-r--r--/code permissions, except for the script, which is coderwx-r-xr-x/code.  So, what magic must be performed to get my webapp to load/unload my launchd configuration on start/stop?  Side note: Obviously these configurations and scripts are simple examples I've used for debugging purposes and to simplify the details here. In reality I'm trying to stand up an instance of Tomcat as a "webapp" to run behind Apache 2 on my server such that I can deploy true web apps through Tomcat and have them served to the web.)  Side note 2: I know I can install my codelaunchd.plist/code in code/Library/LaunchDaemons/code, and omit the codelaunchKeys/code from my codewebapp.plist/code as a workaround, but this does not allow me to start/stop the webapp via Server.app (or the command line equivalent), and, I mean, it emshould/em work, right?  Many thanks,  Levi  (crosspost from https://discussions.apple.com/message/27946624 )  <answer179495> It turns out the setup I posed in my question is correct, and works as expected. This was confirmed by @klanomath, who was able to reproduce my configuration and see things working as expected. Specifically:  After issuing:  precode$ sudo webappctl start org.apache.tomcat /code/pre  I get the expected "Here I am!" message in code/var/log/system.log/code.  The solution for me was to simply restart my machine.  Take note, seemingly, the launchd configurations in code/Applications/Server.app/Contents/ServerRoot/System/Library/LaunchDaemons//code appear to be cached somehow, and changes made there are not picked up by codewebappctl/code until something* is restarted.  Hopefully this will save someone the day it took me to have a gentle "have you tried restarting?" suggestion solve the issue.  Levi  *I'm not sure what needs to be restarted... I tried starting and stopping the webserver and Server.app, enabling and disabling the web app from within Settings.app GUI, with no effect. The only thing which picked up the changes was a full system restart.  <comment212577> @klanomath Thanks. A copy paste error. I've fixed it in the post. <comment212611> After setting up your example in a VM the command `webappctl start org.apache.tomcat` just works. Maybe it's some caching problem. Did you try to restart your Mac/empty the caches? Or restart the web server? <comment212699> @klanomath Thanks, I'lve not restarted yet... will try. Did you get the "Here I am!" message in `/var/log/system.log`? To be clear, there's no error from `webappctl start org.apache.tomcat` (it seems to work), but the error manifests in the `system.log` as I've documented. <comment212701> Yes, I got several "Here I am" messages in the system.log. Those from the `sudo launchctl load org.levi.foo.plist` (of course) and also from `sudo webappctl start org.apache.tomcat`. After executing the latter you also get a 3-liner response in your shell which states that org.apache.tomcat is RUNNING now. <comment212750> Oh good grief. @klanomath, many thanks for your second set of eyes and suggestion to restart. A restart of the machine and now it works as I expected. <comment212756> You are welcome :-). Now you may write an answer and i will upvote it ;-)