Lion Recovery Terminal will not allow me to run TestDisk? <body> strongSetup:/strong Macbook Air (2011) running Lion with BootCamp (Windows 7).  strongProblem:/strong I have somehow screwed up my partition table. When I boot I only can select Windows instead of Windows and Lion. However Windows gives a BSOD regardless of safe mode option selected.   strongMy Attempt:/strong I have booted into Lion Recovery and tried running Disk Utility to repair disk volumes but it fails. Also tried to reinstall Lion but unable to because Lion doesn't recognize disk volumes (however it does see that there are two main partitions but they are grayed out).   I have data on both partitions I would like to recover so I am trying to use TestDisk to rebuild the partition table, but when I launch TestDisk from my external thumbdrive I get "Illegal instruction: 4".  <answer46695> Have you tried booting from a Linux LiveCD (well, instead of a CD, you'll need a USB thumb drive, but it's the same idea)? From there you could copy data to an external hard drive and just wipe the internal hard drive and reinstall.  If you have another Mac laying around with Thunderbolt, you can boot your Mac into Target Disk Mode (hold down T while booting), connect the Macs together with a Thunderbolt cable, and perform any disk recovery from there. (You might be able to go to an Apple Store and use one of their Thunderbolt Macs to recover your drive; they can be surprisingly permissive at times.)  <answer118513> I did almost the same exact thing to my mac too. Here are some good resources/sites that may help you get started fixing this, or a similar, issue:  Backup you files before attempting repairs. (Also some of the comments on this site may be helpful too.)  Here is a link to a data recovery program that I saw a local Mac repairman use. But you do have to pay for it, and I can't guaranty that it will be anymore helpful than the simple freeware above. But it does seem to have a nice interface, and offers a trial version if you want to try it.  <comment68742> Please edit your question to state whether your external thumb drive: (a) is limited to Recovery OS or (b) has a full installation of OS X. <comment138279> Instead of posting three overlapping answers, can you please post only one combining the essentials? You can also come back later and edit your previous answer to add new stuff. The [FAQ] also has some hints on writing good answers. <comment139031> Hey Patrix, Thanks for the suggestion, and that's actually exactly what I _tried_ to do. But this site doesn't let new users like me post more than 2 links.  If possible, please undelete my posts or merge them for me. Otherwise it's not a complete answer, because the freeware links I provided are actually really good.  Thanks for your help. <comment139032> Here are the two links that I would like to be returned:   Deep file recovery (more through):   http://www.cgsecurity.org/wiki/TestDisk    Read-only file recovery (less advanced):  http://www.cgsecurity.org/wiki/PhotoRec <comment161885> Did you solve your problem? I have exactly the same