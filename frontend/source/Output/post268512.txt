How to setup the adaptive firewall <body> I have followed this link: Turn on the adaptive firewall in macOS Server  and I get this output, but I don't know if I have indeed activated the adaptive firewall:  precodeNo ALTQ support in kernel ALTQ related functions disabled No ALTQ support in kernel ALTQ related functions disabled pf enabled Token : 13540967312582709951 No ALTQ support in kernel ALTQ related functions disabled /code/pre  I want to let the adaptive firewall automatically add users with several failed attempts to login.  I have successfully added a certain IP to the firewall blacklist, but I was unable to see it at hb_summary, don't know if it is supposed to show manually added IP's there. And it was not adding automatically when I supposedly turned it on.  There was a brute force attack at my IMAPs port, and my adaptive firewall was not adding that IP in the blacklist. Only postfix was dealing with it by doing a fatal error because of too many errors and the program terminated, but it was just for a very short period of time.  Server specs:  ul liServer.app 3.2.2/li liMac OS X 10.9.5/li /ul  <answer268834> After diving into the Adaptive Firewall once more I got the impression that the whole system is flawed and the documentation is a mess.  The command code.../hb_summary/code apparently doesn't work at all because it seems to rely on the file /private/var/db/af/blockedHosts getting populated by emipfw/em which isn't activated in 10.9 (and wouldn't work with the 400.AdaptiveFirewall anchor). empf/em doesn't use the file blockedHosts at all.  The best you can do is the following:  ul liEnable the Adaptive Firewall service  precodesudo /Applications/Server.app/Contents/ServerRoot/usr/sbin/serverctl enable service=com.apple.afctl /code/pre/li liPopulate the whitelist with  precodesudo /Applications/Server.app/Contents/ServerRoot/usr/libexec/afctl -c /code/pre/li liDefine max bad auth attempts (e.g. 3) and ban time (e.g. 60 minutes)  precodesudo /Applications/Server.app/Contents/ServerRoot/usr/libexec/afctl -T 3 sudo /Applications/Server.app/Contents/ServerRoot/usr/libexec/afctl -H 60 /code/pre  This will modify the file /Applications/Server.app/Contents/ServerRoot/private/etc/emond.d/rules/AdaptiveFirewall.plist.  Check the mod with:  precodesudo grep -m 2 -A 4 hostBlockThreshold /Applications/Server.app/Contents/ServerRoot/private/etc/emond.d/rules/AdaptiveFirewall.plist /code/pre/li liRelaunch emond: codesudo killall emond/code/li liAdd known bad hosts for a long time:  precodesudo /Applications/Server.app/Contents/ServerRoot/usr/libexec/afctl -a 104.16.35.178 -t 1000000 /code/pre  (Please be aware of the y2038 problem). This will modify the file /private/var/db/af/blacklist. Hosts added here usually don't survive a reboot./li liStart af with codesudo /Applications/Server.app/Contents/ServerRoot/usr/libexec/afctl -f/code/li liTo get blocked hosts enter:  precodesudo pfctl -a com.apple/400.AdaptiveFirewall -t blockedHosts -T show -vvv /code/pre  To get pf's state enter codesudo pfctl -s all/code./li /ul  This is tested with hostile codessh/code and codeopenssl s_client -connect imapserver_ip:993/code login attempts.  hr  After a reboot the code.../afctl -f/code command will start pf and af but in at least one of two cases it doesn't block hostile login attempts though it's announced in the log file.   hr  Improvements:  After modifying the keys emdebugLevel/em and emlogEvents/em in the file /etc/emond.d/emond.plist,:  precode    ...     &lt;key&gt;debugLevel&lt;/key&gt;     &lt;integer&gt;3&lt;/integer&gt;     ...     &lt;key&gt;logEvents&lt;/key&gt;     &lt;true/&gt;     ... /code/pre  creating the file /System/Library/LaunchDaemons/com.apple.afctl_boot.plist with the content:  precode&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt; &lt;plist version="1.0"&gt; &lt;dict&gt;     &lt;key&gt;Disabled&lt;/key&gt;     &lt;false/&gt;     &lt;key&gt;Label&lt;/key&gt;     &lt;string&gt;com.apple.afctl_boot&lt;/string&gt;     &lt;key&gt;Program&lt;/key&gt;     &lt;string&gt;/Applications/Server.app/Contents/ServerRoot/usr/libexec/afctl&lt;/string&gt;     &lt;key&gt;ProgramArguments&lt;/key&gt;     &lt;array&gt;         &lt;string&gt;/Applications/Server.app/Contents/ServerRoot/usr/libexec/afctl&lt;/string&gt;         &lt;string&gt;-f&lt;/string&gt;     &lt;/array&gt;     &lt;key&gt;RunAtLoad&lt;/key&gt;     &lt;true/&gt; &lt;/dict&gt; &lt;/plist&gt; /code/pre  and loading it with:  precodesudo launchctl load /System/Library/LaunchDaemons/com.apple.afctl_boot.plist /code/pre  it seems to work more reliably. The Adaptive Firewall will be loaded at boot time. No further afctl launch command is required!  <comment338308> First of all, thank you very much for the awesome tutorial! Is in indeed a mess, all the data that apple have published about setting up this firewall in previous versions of macosx. <comment338309> I have made several tests, and i discover that my server doesnt allowed more then 6 attempts to login through the same username by default, but was unable to add the bad IP in the blacklist automatically till now. After i made the tutorial till the "improvement" part, i notice that now with hostBlockThreshold of 12 and hostMinBlockTime of 60, it is working fine  (i have made this test at least 2 times and both work fine). <comment338310> I will do the improvement part to avoid have to exec that afctl -f every time i reboot the system.  P.S. I will change the title of this question to be more intuitive for others that may encounter this problem. <comment338312> Just to let you know that in my system i had LaunchDaemons instead of yours LaunchDaemon.  How can i have access to the emond logevents? (I have already changed emond.plist as you have made in improvements) <comment338321> @SipriusPT LaunchDaemon was misspelled and I corrected it! <comment338339> also the daemon seems to be working fine =) with this i notice that i was having a lot of authentication failures at my postfix service, from 'good' IPs, my external IP got blacklisted has well as other user IP, i will have to see this next =) <comment338343> @SipriusPT The first sentence (... flawed ... mess.) of my answer is the most important. I recommend to commit firewalling to an external device (like a dedicated firewall).