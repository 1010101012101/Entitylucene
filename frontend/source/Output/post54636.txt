How to fix hanging Server Admin, log shows servermgrd error in getAndLockContext: flock(servermgr_info) FATAL time out <body> On a 10.7.4 Lion Server installation the Server Admin.app fails to start correctly. The window is drawn and the last known server and its services are displayed, but a spinning wheel keeps spinning on the bottom status bar.  Console.app log shows:  precodeJun 24 18:19:56 mac01 servermgrd[437]: [437] error in getAndLockContext: flock(servermgr_info) FATAL time out Jun 24 18:19:56 mac01 servermgrd[437]: [437] process will force-quit to avoid deadlock Jun 24 18:19:56 mac01 servermgrd[437]: outstanding requests are: (             {             Command = getHistory;             Module = "servermgr_info";             Timestamp = "2012-06-24 16:17:51 +0000";         },             {             Command = getState;             Module = "servermgr_info";             Timestamp = "2012-06-24 16:17:51 +0000";         },             {             Command = Idle;             Module = "servermgr_info";             Timestamp = "2012-06-24 16:18:50 +0000";         }     ) Jun 24 18:19:56 mac01 com.apple.launchd[1] (com.apple.servermgrd[437]): Exited with code: 1 /code/pre  There are strong3 services enabled: dns, firewall, mail/strong. DNS plugin gave an error message which cannot be reproduced.  Other errors in Console.app are:  precodeJun 28 12:49:58 mac01 ServerBackup[32087]: Error in calling backup command for service postgresql, error :=69 Jun 28 12:51:24 mac01 mds[99]: (Error) Volume: Could not find requested backup type:2 for volume Jun 28 12:53:01 mac01 mds[99]: (Error) Server: ==== XPC handleXPCMessage XPC_ERROR_CONNECTION_INVALID /code/pre  (Regression) Other sources suggested to try:  ol lireview DNS settings, no problem found there/li licheck the hostname with codesudo changeip -checkhostname/code, no problem found there/li lidestroy the Open Directory installation, OD is not used here/li lireboot, that did not solve the problem/li lireplace code/Library/Preferences/com.apple.servermgrd.plist/code with a known good copy, that did not help/li lireplace the Server Admin.app itself with a known good copy, also did not improve/li liissuing a codesudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.servermgrd.plist;sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.servermgrd.plist/code, as in my answer below, which only partly solves the issue. Server Admin started correctly once, but on second and consecutive launches the spinning wheel keeps spinning again and log shows the deadlock situations again./li liuntick 'require valid digital signature (SSL)' in server admin prefs just incase you haven't trusted your server cert, no change./li licheck if it is a user issue, by creating a new admin user and try starting server admin from that login, errors out (kReceivedUnknownError says Server Admin, process will force-quit to avoid deadlock is in the log, but no outstanding requests are in the log)/li liChanged the connecting server address from 'name.local' to '127.0.0.1', no change./li licodesudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.servermgrd.plist;sudo rm -r /var/servermgrd;sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.servermgrd.plist/code, no change/li liServer.app  hardware  hostname  settings  uncheck dedicate resources to server services, reboot, check again, reboot, no change /li licode$ diskutil repairPermissions /;sudo reboot/code, no change/li licorrected the rDNS entry to match the machine name, so that Server.app no longer displays an alert that the network has changed on every boot./li /ol  Other repeating log file entries are:  precode29-06-12 02:58:01,943 configd: network configuration changed. 29-06-12 02:58:33,575 configd: network configuration changed. 29-06-12 02:58:33,597 configd: network configuration changed. 29-06-12 02:58:34,266 servermgrd: servermgr_ipfilter:ipfw config:Notice:Flushed IPv4 rules 29-06-12 02:58:34,578 servermgrd: servermgr_ipfilter:ipfw config:Notice:Flushed IPv6 rules 29-06-12 02:59:50,707 servermgrd: servermgr_filebrowser:Error:servermgr_filebrowser: Error getting quotas for volume /Volumes/H of type exfat /code/pre  After hours of trying to isolate the problem, I can reproduce that the flock(servermgr_info) FATAL time out is related to the local DNS service. When DNS service is started the Server Admin.app generates the flock(servermgr_info) FATAL time out, when DNS is then stopped (and code$ sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.servermgrd.plist;sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.servermgrd.plist/code to be sure that there is a clean starting point) next time Server Admin.app behaves OK and no flock(servermgr_info) FATAL time out is logged.  Anonymised serveradmin DNS configuration extracted using code$ sudo serveradmin settings dns/code) is here:  precodedns:acls:_array_index:0:name = "com.apple.ServerAdmin.DNS.public" dns:acls:_array_index:0:addressMatchList:_array_index:0 = "localhost" dns:views:_array_id:com.apple.ServerAdmin.DNS.public:secondaryZones:_array_id:xyz.nl:name = "xyz.nl" dns:views:_array_id:com.apple.ServerAdmin.DNS.public:secondaryZones:_array_id:xyz.nl:ipAddresses:_array_index:0 = "1.1.1.237" dns:views:_array_id:com.apple.ServerAdmin.DNS.public:secondaryZones:_array_id:xyz.nl:ipAddresses:_array_index:1 = "2.2.1.247" dns:views:_array_id:com.apple.ServerAdmin.DNS.public:secondaryZones:_array_id:xyz.nl:ipAddresses:_array_index:2 = "1.2.1.59" dns:views:_array_id:com.apple.ServerAdmin.DNS.public:secondaryZones:_array_id:xyz.nl:ipAddresses:_array_index:3 = "2.1.1.23" dns:views:_array_id:com.apple.ServerAdmin.DNS.public:primaryZones = _empty_array dns:views:_array_id:com.apple.ServerAdmin.DNS.public:allowRecursion = "com.apple.ServerAdmin.DNS.public" dns:views:_array_id:com.apple.ServerAdmin.DNS.public:reverseZones = _empty_array dns:views:_array_id:com.apple.ServerAdmin.DNS.public:name = "com.apple.ServerAdmin.DNS.public" dns:isBonjourClientBrowsingEnabled = no /code/pre  Irony is that localhost is not configured as DNS resolver:  precode$ networksetup -getdnsservers Ethernet 91.196.170.5 8.8.8.8 8.8.4.4 /code/pre  When DNS service is stopped, Server Admin sometimes still keeps spinning. Having a look at Servername  Network  shows that in the pane with "Network Interfaces" the DNS name is empty.  codenslookup -type=ptr z.y.x.91.in-addr.arpa/code returns the correct value. A codedig PTR z.y.x.91.in-addr.arpa/code for the PTR is ok, and a codedig PTR z.y.x.91.in-addr.arpa +trace/code stops after recursion number 4:  precode.           77760   IN  NS  m.root-servers.net. ...&lt;cut&gt;... .           77760   IN  NS  l.root-servers.net. ;; Received 244 bytes from 91.196.170.5#53(91.196.170.5) in 5 ms  in-addr.arpa.       172800  IN  NS  a.in-addr-servers.arpa. ...&lt;cut&gt;... in-addr.arpa.       172800  IN  NS  f.in-addr-servers.arpa. ;; Received 432 bytes from 192.203.230.10#53(e.root-servers.net) in 7 ms  91.in-addr.arpa.    86400   IN  NS  sec3.apnic.net. ...&lt;cut&gt;... 91.in-addr.arpa.    86400   IN  NS  sns-pb.isc.org. ;; Received 200 bytes from 193.0.9.1#53(f.in-addr-servers.arpa) in 2 ms  170.196.91.in-addr.arpa. 172800 IN  NS  ns2.technotop.nl. 170.196.91.in-addr.arpa. 172800 IN  NS  ns3.technotop.nl. 170.196.91.in-addr.arpa. 172800 IN  NS  ns1.technotop.nl. ;; Received 110 bytes from 193.0.9.5#53(pri.authdns.ripe.net) in 1 ms  ;; connection timed out; no servers could be reached /code/pre  Now there is also a new message logged:  precodeJun 29 14:49:10 mac01 servermgrd[1039]: Still servicing 0:0 requests after 300 seconds, with 1 sessions outstanding, resetting idleTimer /code/pre  hr  strongUpdate #1/strong It looks like the issue might be a rDNS (reverse DNS) PTR configuration error. A codedig +trace/code from a 10.5 machine at a different location results in codecouldn't get address for 'ns3.technotop.nl': not found/code. The network provider has been asked to fix this flaky (and faulty) DNS configuration.   hr  strongUpdate #2/strong Another suspect is the built-in firewall. When the firewall is stopped there are no hangs. When the firewall is started, the spinning wheel never stops.  hr  strongUpdate #3/strong The provider fixed ns3.technotop.nl by assigning a DNS A record with IP address 91.196.170.72 at August 23th. Result: still a spinning wheel at the bottom right part of Mac OS Server Admin, and after a few minutes      "strongThe service has encountered an error./strong    Try to refresh the view   (127.0.0.1/Server). (kReceivedUnkownError).   Followed by a:     "strongThe service has encountered an error./strong    Try to refresh the view   (127.0.0.1/Certificates). (kReceivedUnkownError).   strongUpdate #4/strong The next issue is a CentOS version 5.4 software firewall at the servers where both ns1.technotop.nl and ns2.technotop.nl are running on, that kicked in on Mac OS X 10.7.4 Lion + Server + Admin Tools DNS traffic patterns:     123.45.67.89 # lfd: (PERMBLOCK) 123.45.67.89 has had more than 4 temp blocks in the last 86400 secs - Sun Jun 17 21:20:08 2012   After clearing this block in the CentOS firewall, the firewall block is back within 10 hours for each IP address that is running 10.7.4 and is having a reverse DNS name that is authoritatively served by the CentOS 5.4 machines.  Let's see what a whitelist on the CentOS firewall will do for machines running Mac OS 10.7.4.  hr  strongQuestion/strong  How to fix this DNS service related servermgrd flock(servermgr_info) error (for instance by factory default resetting dns service)?  <answer54637> code$ sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.servermgrd.plist/code and the issue was gone for a few minutes.  <answer56117> ol liAdd a firewall "Address Group" for IP address "127.0.0.1"./li liGive the "Services"-tab "Allow all traffic" permissions for that newly created group./li /ol  <answer62155> Review the firewall configuration of the authoritative DNS servers for the PTR records of your (public) IP address.  In our case, when looking up the PTR records of the public IP address (123.45.67.89 for example) by using the reverse notation (89.67.45.123.in-addr.arpa) in Terminal on the Lion Server:  ol licode$ dig NS 67.45.123.in-addr.arpa +short/code results in:  ns1.technotop.nl.  ns2.technotop.nl./li licode$ dig PTR 89.67.45.123.in-addr.arpa @ns1.technotop.nl/code results in:  ; &lt;&lt; DiG 9.7.3-P3 &lt;&lt; PTR 89.67.45.123.in-addr.arpa @ns1.technotop.nl  ;; global options: +cmd   ;; connection timed out; no servers could be reached/li /ol  In other words the DNS packets were discarded by an intermediary firewall.  After whitelisting the IP adress of the Mac OS X Server in the firewall of each authorative DNS server, the "getAndLockContext: flock(servermgr_info) FATAL time out" issue was gone.  <answer62380> I had the same issue. As suggested here, I tracked the problem down to a bad NS record (typo) for the reverse zone.  changeip -checkhostname reported no issues manually checking the forward/reverse all looked good.  But when I specifically checked the NS record for the reverse zone, noticed the typo.  <comment62576> This solved only on first Server Admin.app launch, on later launches the flock(servermgr_info), force quit to prevent a deadlock, and spinning wheel situation was back. <comment64437> Creating this firewall rule, is not enough. The error messages like `servermgrd: error in getAndLockContext: flock(servermgr_info) FATAL time out` and `servermgrd: process will force-quit to avoid deadlock` are still popping up.