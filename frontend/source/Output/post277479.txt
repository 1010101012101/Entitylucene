openssh hangs at "rekey after 134217728 blocks" <body> First up, I have searched around for a full day now and although there are emsimilar/em problems around, I can't find anyone having this exact problem.  My hackintosh running 10.12.3 has OpenSSH installed via homebrew. It hangs at the exact same "rekey" line no matter which server I am connecting to, and I have no idea why.  em(note: the expected result from the below should end with/em      Permission Denied (publickey).   embecause I haven't installed the cert, instead I am only using git@github.com to test. But it doesn't even make it that far, and that is the problem. My home server box running ubuntu yields the same hang point.)/em  precode➜  ~ ssh -vvv -T git@github.com OpenSSH_7.5p1, OpenSSL 1.0.2k  26 Jan 2017 debug1: Reading configuration data /usr/local/etc/ssh/ssh_config debug2: resolving "github.com" port 22 debug2: ssh_connect_direct: needpriv 0 debug1: Connecting to github.com [192.30.255.112] port 22. debug1: Connection established. debug1: key_load_public: No such file or directory debug1: identity file /Volumes/StorageRAID/ajlowndes/.ssh/id_rsa type -1 debug1: key_load_public: No such file or directory debug1: identity file /Volumes/StorageRAID/ajlowndes/.ssh/id_rsa-cert type -1 debug1: key_load_public: No such file or directory debug1: identity file /Volumes/StorageRAID/ajlowndes/.ssh/id_dsa type -1 debug1: key_load_public: No such file or directory debug1: identity file /Volumes/StorageRAID/ajlowndes/.ssh/id_dsa-cert type -1 debug1: key_load_public: No such file or directory debug1: identity file /Volumes/StorageRAID/ajlowndes/.ssh/id_ecdsa type -1 debug1: key_load_public: No such file or directory debug1: identity file /Volumes/StorageRAID/ajlowndes/.ssh/id_ecdsa-cert type -1 debug1: key_load_public: No such file or directory debug1: identity file /Volumes/StorageRAID/ajlowndes/.ssh/id_ed25519 type -1 debug1: key_load_public: No such file or directory debug1: identity file /Volumes/StorageRAID/ajlowndes/.ssh/id_ed25519-cert type -1 debug1: Enabling compatibility mode for protocol 2.0 debug1: Local version string SSH-2.0-OpenSSH_7.5 debug1: Remote protocol version 2.0, remote software version libssh-0.7.0 debug1: no match: libssh-0.7.0 debug2: fd 5 setting O_NONBLOCK debug1: Authenticating to github.com:22 as 'git' debug3: hostkeys_foreach: reading file "/Volumes/StorageRAID/ajlowndes/.ssh/known_hosts" debug3: record_hostkey: found key type RSA in file /Volumes/StorageRAID/ajlowndes/.ssh/known_hosts:2 debug3: load_hostkeys: loaded 1 keys from github.com debug3: order_hostkeyalgs: prefer hostkeyalgs: ssh-rsa-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-256,ssh-rsa debug3: send packet: type 20 debug1: SSH2_MSG_KEXINIT sent debug3: receive packet: type 20 debug1: SSH2_MSG_KEXINIT received debug2: local client KEXINIT proposal debug2: KEX algorithms: curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha256,diffie-hellman-group14-sha1,ext-info-c debug2: host key algorithms: ssh-rsa-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-256,ssh-rsa,ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,ssh-ed25519 debug2: ciphers ctos: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc debug2: ciphers stoc: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc debug2: MACs ctos: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 debug2: MACs stoc: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 debug2: compression ctos: none,zlib@openssh.com,zlib debug2: compression stoc: none,zlib@openssh.com,zlib debug2: languages ctos: debug2: languages stoc: debug2: first_kex_follows 0 debug2: reserved 0 debug2: peer server KEXINIT proposal debug2: KEX algorithms: curve25519-sha256@libssh.org,ecdh-sha2-nistp256,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1 debug2: host key algorithms: ssh-dss,ssh-rsa debug2: ciphers ctos: chacha20-poly1305@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr,aes256-cbc,aes192-cbc,aes128-cbc,blowfish-cbc debug2: ciphers stoc: chacha20-poly1305@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr,aes256-cbc,aes192-cbc,aes128-cbc,blowfish-cbc debug2: MACs ctos: hmac-sha1,hmac-sha2-256,hmac-sha2-512 debug2: MACs stoc: hmac-sha1,hmac-sha2-256,hmac-sha2-512 debug2: compression ctos: none,zlib,zlib@openssh.com debug2: compression stoc: none,zlib,zlib@openssh.com debug2: languages ctos: debug2: languages stoc: debug2: first_kex_follows 0 debug2: reserved 0 debug1: kex: algorithm: curve25519-sha256@libssh.org debug1: kex: host key algorithm: ssh-rsa debug1: kex: server-&gt;client cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none debug1: kex: client-&gt;server cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none debug3: send packet: type 30 debug1: expecting SSH2_MSG_KEX_ECDH_REPLY debug3: receive packet: type 31 debug1: Server host key: ssh-rsa SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8 debug3: hostkeys_foreach: reading file "/Volumes/StorageRAID/ajlowndes/.ssh/known_hosts" debug3: record_hostkey: found key type RSA in file /Volumes/StorageRAID/ajlowndes/.ssh/known_hosts:2 debug3: load_hostkeys: loaded 1 keys from github.com debug3: hostkeys_foreach: reading file "/Volumes/StorageRAID/ajlowndes/.ssh/known_hosts" debug3: record_hostkey: found key type RSA in file /Volumes/StorageRAID/ajlowndes/.ssh/known_hosts:11 debug3: load_hostkeys: loaded 1 keys from 192.30.255.112 debug1: Host 'github.com' is known and matches the RSA host key. debug1: Found key in /Volumes/StorageRAID/ajlowndes/.ssh/known_hosts:2 debug3: send packet: type 21 debug2: set_newkeys: mode 1 debug1: rekey after 134217728 blocks debug1: SSH2_MSG_NEWKEYS sent debug1: expecting SSH2_MSG_NEWKEYS debug3: receive packet: type 21 debug1: SSH2_MSG_NEWKEYS received debug2: set_newkeys: mode 0 debug1: rekey after 134217728 blocks /code/pre  I also tried a previous version of ssh:  precode➜  ~ /usr/local/Cellar/openssh/7.4p1/bin/ssh -vvv -T git@github.com /code/pre  with exactly the same result.  And I tried the macOS native version like so:  precode➜  ~ /usr/bin/ssh -vvv -T git@github.com OpenSSH_7.3p1, LibreSSL 2.4.1  ... {same stuff} ...  Warning: Permanently added the RSA host key for IP address '192.30.255.113' to the list of known hosts. debug3: send packet: type 21 debug2: set_newkeys: mode 1 debug1: rekey after 134217728 blocks debug1: SSH2_MSG_NEWKEYS sent debug1: expecting SSH2_MSG_NEWKEYS debug3: receive packet: type 21 debug2: set_newkeys: mode 0 debug1: rekey after 134217728 blocks debug1: SSH2_MSG_NEWKEYS received /code/pre  I note that the last three lines are in a different order, otherwise there seems to be no difference.  Other computers (e.g. MacBook Air) with mac's native ssh have no problem. It is only the hackintosh. Any ideas where I can troubleshoot next?  Thanks in advance.  Note: I can ssh TO the hackintosh no problem, just not from it.  <answer280800> The issue is ssh is waiting for a connection to your ssh-agent. You can test this by running codeSSH_AUTH_SOCK= ssh git@github.com/code.  If this is indeed the issue (as it was for me), then you probably have multiple LaunchAgents that are listening on to the socket at codeSSH_AUTH_SOCK/code and one of them is doing the wrong thing. For example, I had one from MacPorts that was trying to run code/opt/local/bin/ssh-agent -l/code but that codessh-agent/code did not exist any longer.  You should have one LaunchAgent for codessh-agent/code in code/System/Library/LaunchAgents/com.openssh.ssh-agent.plist/code but you may have others in code/Library/LaunchAgents/code or code~/Library/LaunchAgents/code. If so, unload the codessh-agent/code LaunchAgents using codelaunchctl unload/code or simply delete them and logout and back in (or maybe restart, I'm not sure if a logout is sufficient). Hopefully, that should fix your problem.  <comment349243> ssh doesn't find a valid key_file (check the lines 7-22: all show the type -1 response). Have you tried the `ssh -i ...` [command](http://askubuntu.com/a/793584/341247) <comment354617> Not being able to contact the SSH agent was the cause of this problem in my case. As a GNU/Linux user, I just joined this site to upvote this answer – which as of now hasn't been accepted or received any upvotes :( <comment355049> Sorry for the delay there - I have accepted this answer now, it has just taken a really long time to come back to this issue to test. Thanks TH!