How to fix failing Open Directory (database "cn=authdata" cannot be opened, err 12) after hang <body> A Mac OS X Lion 10.7.5 server running Open Directory hung. SSH was still possible but the codesudo reboot/code command didn't restart the server within 15 minutes. That is why a power cycle was issued. After the power cycle Open Directory would no longer start and the System log is filled with a new message every 10 seconds:  precodecom.apple.launchd[1] (org.openldap.slapd[1153]): Exited with code: 1 com.apple.launchd[1] (org.openldap.slapd): Throttling respawn: Will start in 10 seconds /code/pre  Repairing disk permission, neither another reboot doesn't solve the issue.  Slapd in Tool mode outputs:  precode$ sudo /usr/libexec/slapd -Tt bdb(dc=nl2,dc=probackup,dc=nl): unable to allocate memory for mutex; resize mutex region bdb_db_open: database "dc=nl2,dc=probackup,dc=nl" cannot be opened, err 12. Restore from backup! backend_startup_one (type=bdb, suffix="dc=nl2,dc=probackup,dc=nl"): bi_db_open failed! (12) slap_startup failed (test would succeed using the -u switch) /code/pre  How to fix this?  <answer79142> To repair the Open Directory authdata database:  precode$ sudo launchctl unload /System/Library/LaunchDaemons/org.openldap.slapd.plist /code/pre  Now start the database recovery using the command below that matches your OS version.  precode$ sudo db_recover -h /var/db/openldap/authdata/ # Mac OS X 10.7 $ sudo db_recover -h /var/db/openldap/openldap-data/ # Mac OS X 10.6 /code/pre  Now slapd in tool mode outputs:  precode$ sudo /usr/libexec/slapd -Tt bdb_db_open: database "dc=nl2,dc=probackup,dc=nl": unclean shutdown detected; attempting recovery. bdb_db_open: database "dc=nl2,dc=probackup,dc=nl": recovery skipped in read-only mode. Run manual recovery if errors are encountered. bdb_monitor_db_open: monitoring disabled; configure monitor database to enable config file testing succeeded /code/pre  Now turn back on Open Directory:  precode$ sudo launchctl load /System/Library/LaunchDaemons/org.openldap.slapd.plist /code/pre  And issue another restart to be better safe than sorry:  precode$ sudo reboot /code/pre  Open Directory is now up and running again.  <answer112933> First best is to check the disk you may do so either using the recovery partition or single user (strongcmd/strong - strongS/strong at startup) then type :  precodefsck -fy /code/pre  emQWERTY keyboard the dash is 2 key left from backspace./em  To re-import a corrupted database from a backup you should backup and replace the following files/ folders :  ul listrongvar/db/openldap//strong/li listrongusr/bin/db_recover/strong/li /ul  Not sure it's necessary but if you have removed the LDAPv3 entry in the System keychain :  ul listrongLibrary/Keychains/System.keychain/strong/li /ul  The try a recoveryâ€¦  Then you should repair disk permissions from a terminal (not single user) :  precodediskutil repairPermissions / /code/pre  If after the recovery you experience problem connecting to services check the configuration under "strongServices/strong" tab in Directory Utility.  <answer189200> This is how I usually repair a broken LDAP/OD  strong1./strong check if this is the problem  codesudo /usr/libexec/slapd -Tt/code*  You might get:  bdb_db_open: database "cn=authdata": db_open(/var/db/openldap/authdata/id2entry.bdb) failed: Invalid argument (22).  strong2./strong Stop LDAP on OD Master  codesudo launchctl unload /System/Library/LaunchDaemons/org.openldap.slapd.plist/code  strong3./strong Repair Permissions  codediskutil repairPermissions //code  strong4./strong backup openldap db  precodesudo cp /var/db/openldap/authdata/id2entry.bdb /var/db/openldap/authdata/id2entry.bdb.backup /code/pre  strong5./strong repair  codesudo db_recover -cv -h /var/db/openldap/openldap-data//code  strong6./strong run repair again to check  codesudo db_recover -cv -h /var/db/openldap/openldap-data//code  strong7./strong do it one more time so things are repaired correctly  codesudo /usr/libexec/slapd -Tt/code  strong8./strong restart the service  codesudo launchctl load /System/Library/LaunchDaemons/org.openldap.slapd.plist/code  strong9./strong If the above does not work, try:  codesudo db_recover -cv -h /var/db/openldap/authdata//code  then I restart the service with step 8.   codesudo launchctl load /System/Library/LaunchDaemons/org.openldap.slapd.plist/code  emThis usually fixes the problem... but in some cases you need to restore like llange explaines in his post./em  <comment218414> This approach didn't exactly do the trick for me, but it set me on the right track. I don't really know what I'm doing with LDAP administration, so YMMV, but after running this command, I was able to restart slapd and my data hadn't been lost: `sudo db_recover -h /var/db/openldap/openldap-data/`. It seems like a different BDB database structure associated with LDAP had been corrupted in my particular case, so may be worth investigating if the above doesn't work for you. Good luck!