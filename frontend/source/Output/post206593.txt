Rebuild partition table on external HDD - not writable <body> I have an external hard drive formatted with 3 HFS+ partitions. To cut a long story short I had it connected to a Windows PC and accidentally started formatting the drive to NTFS. As soon as I realised what was happening I disconnected the drive, but the partition table is corrupted. I used TestDisk to gather info about the partitions, and tried to use pDisk to rebuild the partition table, but when I try to do that, I get the message that the partition table is not writable, the device is busy. Anyone know how I can rewrite the partition table?  Update:  The TestDisk results are like this (for settings on Apple Partition Map - I don't know if this is the correct settings, but it's the only one which gives 3 distinct partitions):  precodeStart:     262208 End:  419692607 Size: 419430400 Start:  419954752 End: 1258815551 Size: 838860800 Start: 1259077696 End: 1953525151 Size: 694447456 /code/pre  Does that look OK?  <answer206619> OS X uses three different types of valid partition tables. Only one of those is written to a particular disk:  ul liGUID partition table/li liApple Partition Table/li liMBR/li /ul  The default partition table on OS X is the GUID partition table.  Depending on the previously used partition table on your disk you have to use different tools to create/change/write it:  ul ligpt for GUID partition table/li lipdisk for Apple Partition Table/li lifdisk for MBR/li /ul  After additional informations given by the OP (testdisk results) and checking it in a virtual machine it's highly probable that the disk was formatted with an Apple Partition Map. Consequently use pdisk to rebuild the partition map.  strongpdisk:/strong  A typical disk formatted with an Apple Partition Table looks like this:  precodeDriver Descriptor Map: Block 0              Size:      1 Block Apple Partition Table: Block 1 - 63         Size:     63 Blocks Apple_Free:            Block 64 - 262207    Size: 262144 Blocks 1st partition:         Block 262208 -  Apple_Free:                                 Size: 262144 Blocks ... Apple_Free:                                 Size: 262144 Blocks last partition Apple_Free:                                 Size:     16 Blocks /code/pre  To recreate the partition map do the following:  ul liattach the external drive/li lidetach any other external drive/li liopen Terminal and enter codediskutil list/code to get the DiskIdentifier (in the step below I assume your DiskIdentifier is disk1/li lienter codediskutil unmountDisk /dev/disk1/code/li lienter codesudo pdisk /dev/rdisk1/code  You will get the following output:     Edit /dev/rdisk1 -br   Command (? for help): /li liNow enter codec/code then enter the start block, the size of the first partition and the name. You have to hit the enter key after every input. Repeat this for the next two partitions. At the end it should look like this:     Command (? for help): cbr   First block: 262208br   Length in blocks: 419430400br   Name of partition: part1br   Command (? for help): cbr   First block: 419954752br   Length in blocks: 838860800br   Name of partition: part2br   Command (? for help): cbr   First block: 1259077696br   Length in blocks: 694447456br   Name of partition: part3br   Command (? for help):   /li liAt the last prompt enter codew/code then codey/code to write the changes to disk and finally codeq/codeto quit pdisk:     Command (? for help): wbr   Writing the map destroys what was there before. Is that okay? [n/y]: ybr   The partition table has been altered!      Command (? for help):  /li liThe missing volumes should mount automatically. Otherwise enter codediskutil mountDisk /dev/disk1/code. Enter codeq/code at the last prompt to quit pdisk, then quit Terminal, open Disk Utility and check the recovered volumes for errors./li /ul  hr  stronggpt:/strong  In the example below I assume the DiskIdentifier of your external disk is disk1 (check this with codediskutil list/code)  First you have to unmount the external disk:  precodediskutil umountDisk disk1 /code/pre  Remove the current MBR and create a GPT with gpt:  precodesudo gpt create -f /dev/disk1 /code/pre  First rebuild the EFI entry with:  precodesudo gpt add -b 40 -i 1 -s 409600 -t C12A7328-F81F-11D2-BA4B-00A0C93EC93B disk1 /code/pre  The EFI partition is a fixed sized partition near the beginning of every GUID partitioned disk (using OS X partitioning tools)  Then add the JHFS+ partition entries with the TestDisk findings:  precodesudo gpt add -b StartBlock -i IndexNumber -s SizeOfVolume -t 48465300-0000-11AA-AA11-00306543ECAC disk1 /code/pre  Example for the first OS X partition:  precodesudo gpt add -b 409640 -i 2 -s SizeOfHFSVolume1 -t 48465300-0000-11AA-AA11-00306543ECAC disk1 /code/pre  After adding a partition with gpt you may have to unmount disk1 with codediskutil umountDisk disk1/code again if your get a "resource is busy" error adding additional partitions.  Increase the index number by 1 for every new partition.  Listed below are answers to similar questions (partly covering other file systems like ExFAT)  ul liHow to fix GUID hard drive corrupted to MBR?/li liHFS+ invalid number of allocation blocks /li liHard drive no longer accessible/li /ul  If you run into problems, leave a comment to the answer with @klanomath.  <answer211244> Thanks to Klanomath for the invaluable help - the above solution worked for two of the partitions using the values generated by TestDisk, but it wouldn't let me do the third, saying there was not enough space. In the end, this solution did work for me and the disk works as it used to: http://perrohunter.com/repair-a-mac-os-x-hfs-partition-table/  <comment250234> Hmmm... What are  the units? Blocks? I don't have a TestDisk at hand right now... And what's the total size of your disk in Bytes (not GB!)/blocks? <comment250249> The units are sectors, and TestDisk says it is 931GiB, with a total of 1953525168 sectors. <comment250252> Do you remember how you formatted the disk? GUID or Apple Partition Map? And do you remember the approximate sizes of your volumes? <comment250261> I think it was os x journaled (in Disk Utility) but it was long time ago so not sure, sizes - I can't remember, I'd guess at around 300GB each. <comment250273> I have to test this in a VM: First I create a disk with GUID partition table and then with an Apple Partition Table. WIll take some time... <comment251005> What would happen if I rebuilt the partition table with the wrong values? Lost data? <comment251006> @IanDoble Rebuilding/writing a partition table just writes to the first few blocks of a disk. If the values are wrong the partition(s) will fail to mount because a proper file system is missing/can't be detected. Often you will be asked to initialize it. DON'T INITIALIZE it. Just remove the partition table or enter other values. <comment251009> Hmmm. I initialized it in Windows before I started to format it, before I unplugged it when I realised I was doing it to the wrong disk. <comment251012> @IanDoble The TestDisk results indicate that the formatting with Windows wasn't (very) successful. I've created a virtual disk with the same size as yours and partitioned it like you did. All the sizes or delta-sizes are typical for an Apple Partition map. So use the 2nd part of my answer. Just try it. Simply creating a partition map doesn't harm the data on your disk. If you create a false partition map it's like creating a wrong index for a book: the content of the book won't be touched but you can't find the proper paragraphs. <comment251026> That seemed to work perfectly for the first two partitions, but for the last one it said "error: no space available on device". The only thing I didn't do from your instructions was rebuild the EFI entry, as I thought it wasn't a GUID disk. <comment251027> @IanDoble You are right: Apple Partition Table doesn't contain an entry for EFI. EFI is GPT only. I will recheck the proper command for the last partition. <comment251028> @IanDoble The command for the last partition below seems to be correct: `First block: 1259077696 Length in blocks: 694447456`. Did you enter the values manually or by copy/paste? <comment251033> Let us [continue this discussion in chat](http://chat.stackexchange.com/rooms/29688/discussion-between-ian-dobie-and-klanomath).