How to fix slow Spotlight and Time Machine after upgrading to  10.7.5? <body> Since updating to 10.7.5 both Spotlight and Time Machine are emvery/em slow.  ul liTo index a normal system drive Spotlight calculates to need several emdays/em./li liAs a result Time Machine takes up to an hour or more for an incremental backup of ~100 Mib./li /ul  What solution is there for these slow Time Machine backups and Spotlight indexing?  <answer65503> According to https://discussions.apple.com/thread/4324046?start=60&amp;tstart=0 disabling Spotlight with code$ sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist/code improves the Time Machine backup speed.  <answer65504> If Spotlight never finishes building the index, it can be because the indexing always stops on certain files. I made a clean installation a few years ago because of that issue, but it returned after I restored my old files. I ended up narrowing down the files that caused it by just adding folders to the privacy tab in System Preferences.  Someone at Super User ran opensnoop to find what files mdworker stopped on:   precodesudo opensnoop -n mdworker /code/pre  From a suggested edit by user37651:     I ran the opensnoop command above and it showed a problem with files in ~/Library/Developer that were put there from a previous Time Machine restore. (I currently don't have XCode installed.) I deleted the folder, and Spotlight indexing finished in only 30 minutes. My Time Machine backup now seems to be working.   <answer65667> Check your console log file and look for lines like this (the real log lines will have process IDs and dates):  precodesandboxd: mdworker deny mach-lookup com.apple.ls.boxd mdworker: Unable to talk to lsboxd /code/pre  If you're seeing that, it is probably the source of the problem. Something Appple did with this latest release (also affects Mountain Lion 10.8.2).    I don't know what's really going on other than to say that codemdworker/code (which scans and indexes files for Spotlight) calls codeLSCopyLibraryItemURLs()/code which eventually sends a message to codelsboxd/code.  The Sandbox policy doesn't allow that, so the worker is killed.   So maybe the policy file is wrong, or maybe codemdworker/code shouldn't be making that call.  I don't know.  However, fixing the policy file is relatively easy.  strongPOTENTIALLY DANGEROUS/strong, but easy.    Edit these files as root:  precode/usr/share/sandbox/mdworker.sb /usr/share/sandbox/mdworker-bundle.sb /code/pre  Inside the files you'll find the line:  precode(allow mach-lookup (global-name "com.apple.ocspd")) /code/pre  Right below it, add the line:  precode(allow mach-lookup (global-name "com.apple.ls.boxd")) /code/pre  That's it!    If you want extra comfort, maybe reboot.  Maybe erase your spotlight index and start over:  precodesudo mdutil -E / /code/pre  In fact, I still see codemdworker: Unable to talk to lsboxd/code in my log files but at least now the indexing will finish and Time Machine moves quickly again.  <answer65669> It is possible to delete the Spotlight index and then force Mac OS X to create a fresh Index from scratch. This is usually worth trying in a situation like yours.  I'm afraid I don't know the Terminal commands for doing this. When I need to do it, I use the commercial program MacPilot, from Koingo Software, which costs US $20. They have a fully-functional trial version that you can use for 15 days. If you find it useful, you can decide to pay for it.  I suppose there are other utilities for doing this also.  Of course, once you delete the existing Spotlight index, you need to wait for Spotlight to create a new index. You should let your Mac run uninterrupted for as long as it takes to generate a new one completely.  img src="https://i.stack.imgur.com/39yAM.png" alt="enter image description here"  <answer66053> I posted this workaround in that topic. Here it is (it is not a solution, only a temporary workaround to let my backup and Spotlight work until a fix is released).  Using Terminal:  ol liI disabled Spotlight indexing:  precodesudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist /code/pre/li liI deleted Spotlight index in all my drives (including the backup drives):  precodesudo rm -rf /.Spotlight-V100/Store-V1 /.Spotlight-V100/Store-V2  /.Spotlight-V100/VolumeConfiguration.plist  sudo rm -rf /TimeMachineDrive/.Spotlight-V100/Store-V1 /TimeMachineDrive/.Spotlight-V100/Store-V2  /TimeMachineDrive/.Spotlight-V100/VolumeConfiguration.plist  /code/pre/li /ol  (coderm -rf /.Spotlight-V100/*/code did not work for me.) (This can also be done by excluding the whole drive using privacy setting of Spotlight and then reincluding it.)  ol liI deleted code/var/folders/code content (see this topic to know why):  precodesudo rm -rf /var/folders/* /code/pre/li liI deleted the code.inProgress/code files from my codeBackups.backupdb/code subfolders (put to trash then empty the trash is the only way to do this)./li /ol  It may be necessary to reformat your backup drive instead of only deleting code.inProgress/code files.  ol liI rebooted and then I restarted Spotlight:  precodesudo launchctl load -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist  sudo mdutil -i on -E / /code/pre/li liI waited until Spotlight finished indexing process/li liI launched a new backup using TimeMachine/li liI opened a bugreport to Apple with the title: "TimeMachine hangs when Spotlight is in use under Mac OS X 10.7" praying that many other people will do the same to make this bug a priority./li /ol  Some steps may be useless, but I took all what I learn by reading different topic about slow TM and Spotlight.  <answer66062> h1Damn! Got faster boot times too/h1  I am writing a different answer just to summarize the specific steps I took (I must keep clear that they are part of what is ALREADY written here, not my contribution), because after I took those steps, not only Time Machine is working faster, but my boot time decreased from 1min10secs to 40secs! My boot time always intrigued me as I constantly saw people reporting much lower boot time for the same specs and, somehow, those steps cut 30 seconds off my boot time (Yeah, I tested more than once and, yeah, caches were ok and I took many steps before taking those ones here, including repairing permissions, repairing disk, even defragging with iDefrag2, all to no results). Until now :P  h21/h2  precodesudo mkdir ~/trash_backup sudo mv /var/folders ~/trash_backup/ # backup just in case /code/pre  h22/h2  After that, editing  code/usr/share/sandbox/mdworker.sb/code and code/usr/share/sandbox/mdworker-bundle.sb/code, adding code(allow mach-lookup (global-name "com.apple.ls.boxd"))/code below the line code(allow mach-lookup (global-name "com.apple.ocspd"))/code on both files.  h23/h2  Finally,  precodesudo mdutil -i on -E /; sudo reboot /code/pre  Thanks lauhub and Old Pro. Can anyone explain the decrease on boot time and what the mach-lookup on boxd thing does and possible security issues? Thanks all :)  <answer66261> So I've suffered the same as everyone else but unfortunately didn't read all the multitude of threads in the correct order so basically lost my original TM backup, then my Spotlight db in a failed effort to fix it.  A thread somewhere which I can't find again (I think it was more about slow Spotlight index) had a post from a guy who simply reinstalled 10.7.5 and everything was back to normal. So I did that, and it worked.  After completion of the reinstall I left TM off and allowed Spotlight to index. I went out for a ride and when I came back it was done - 149GB in something less than 90 min. And it works, I've searched for stuff on my HD.  I then turned TM on and it took 2hrs 9min to complete.  So if you are considering spending the time and bandwidth downgrading to 10.7.4 you may wish to consider a reinstall of 10.7.5.  <answer66322> All, I had the same issue, TM anticipated to take days for a brand new backup on a new disk, and indeed it took hours for some 200MB to be completed.   I disabled spotlight with the command indicated above, and - behold - 40GB loaded within 10min and the TM updated is running as smoothly as one would expect.   This is quite an important bug and its disappointing that Apple sends out an "update" that causes problems like this.   <answer66340> The OS X Lion 10.7.5 Supplemental Update released October 04, 2012 includes:     Resolves an issue that may cause Time Machine backups to take a very long time to complete   and, after testing, this seems to have completely resolved the issue.  Note that for me, the emfirst/em backup after installing this update still took unexpectedly long, and included many codecom.apple.backupd[423]: Waiting for index to be ready (100)/code messages, so maybe Spotlight hadn't yet properly re-indexed the drive.  Now, a couple hours later, small backups complete at their usual brisk pace and all is well.  <answer66564> You can completely fix all the mdworker related sandbox errors in Console (including the codecannot talk to lsboxd/code) by editing the codesystem.sb/code profile rather than the mdworker ones. The system.sb file is used by all Apple system processes that run under the sandbox, including mdworker. If you modify this file (which is located in code/System/Library/Sandbox/Profiles/code) to include:  precode(allow mach-lookup (global-name "com.apple.ls.boxd"))  (allow mach-lookup (local-name "com.apple.ls.boxd")) /code/pre  This will stop all the lsbox related mdworker issues.  <answer76062> A simple rebooting into SAFEMODE and then rebooting back to NORMAL MODE appears to have cleared this use up for me.  Went from 3 weeks to 1 hour for back up.  <comment76964> I can confirm both slowdown since 10.7.5. Where a fix for Time Machine slowness is most urgent. Spotlight indexing finished within a few days but Time Machine is running for days and only at 11,59 GB of 53,19 GB. <comment76965> But even a Spotlight index that takes days is uncacceptable. <comment76987> This may or may not work. But since Time Machine relies on Spotlight to know which files need to backup up, this is no real solution. Besides, Spotlight is an essential part of OS X. <comment76989> Indeed this is only a workaround not a solution. In my case it doesn't even speed things up much. <comment76995> Does Spotlight ever finish building the index or does it just shown the remaining time as multiple days? <comment76996> @LauriRanta I didn't wait :) <comment77001> Maybe I'll try this later. The strange thing is that Spotlight worked fine in 10.7.4 and only slowed down after the update to 10.7.5. The files Spotlight has to index didn't change. <comment77017> I've tried your approach by adding *everything* on the system drive to the privacy list of Spotlight. But even then Spotlight took so long to calculate how much time it will need to index the files (which?) that I've aborted the process. Apple, where is the fix?! <comment77276> There are three files: `mdworker-lsb.sb`, `mdworker-scan.sb`, and `mdworker.sb`. They all contain only the line `(allow mach-lookup)` but not `(allow mach-lookup (global-name "com.apple.ocspd"))`. <comment77277> The problem is that Spotlight calculates the time needed for the index to be many *days*. So using MacPilot or the `mdutil` command line tool helps to ease the pain but it doesn't solve the problem. <comment77339> Do you think that the disk drive itself may be corrupted or physically damaged, and that is why the indexing is projected to take so long? Perhaps you should run a diagnostic for disk damage. Clone your system to an external backup disk while you are at it to be safe. <comment77381> No, the drive is fine. Besindes, many other users have the same problem. Take a look at the discussions on Apples site. I have external backup using CCC :) <comment77564> @OldPro I tried to follow your instruction, and am in the same situation as Tichodroma. So now in `mdworker.sb` i have `(allow mach-lookup) (allow mach-lookup (global-name "com.apple.ls.boxd"))` and after I added that line I restarted. Yet time machine is still going snail slow. Can you help please? <comment77684> I confirmed that I had those messages in the console log. I followed the instructions as well. No change for me. I deleted the entire TM bundle for my machine and started a new backup. It made it about 200GB through a 600GB backup and stops. I'm running TM on a Mac Mini Server with a Drobo connected via FW800. My source machine is a MacBook Pro Retina running ML 10.8.2. I rebooted both the server and MBP and tried to continue the backup again. This time, it only made it through about 100GB more and then stops. One more try only did 3GB. Something is stopping it, but I don't know what. <comment77718> @Tichodroma I'm so sorry I misread your comment.  If your `mdworker.sb` already had `(allow mach-lookup)` then (1) you should never bee seeing `sandboxd: mdworker deny mach-lookup com.apple.ls.boxd` in the logs and (2) editing the file won't help.  That goes for you, too @user15380 <comment77777> The solution which I found worked was to delete /var/folders then reboot.  The spotlight index time went from 3 days down to 51 minutes.  Likewise Timemachine, on a newly installed/restored Lion, went from 30 days to about 11 hours. <comment77780> @GrantSayer What's inside this directory? How did you come to this solution? <comment77868> I followed the thread in https://discussions.apple.com/thread/4322106?start=75&tstart=0 which indicated that removing this directory helped.  It appears to have cache information on startup from some applications and services.  This has been the only fix which has worked and after 9 hrs the full backup of 250gb completed. <comment77877> Okay. I found another commonality (seemingly) to the backup failures. I no longer have the deny mach-lookup com.apple.ls.boxd in the console (although I still get the "mdworker: Unable to talk to lxboxd"). However, I do see a bunch of "sandboxd[1289]: ([1288]) mdworker32(1288) deny mach-lookup com.apple.PowerManagement.control ..." messages. Do I need to add another line for com.apple.PowerManagement.control? <comment77885> @jschmidt, You could add another line to the files, but in your case, given what the sandbox files look like in Lion, I'd suggest instead finding the line `;;(allow mach-lookup)` and deleting the semi-colons, which are comment indicators.  In other words, that line was "commented out" by the semi-colons.  Deleting the semi-colons will make it active again, which should take care of all the `sandboxd deny mach-lookup` issues.  Also keep in mind that Time Machine is generally slow, particularly with the first backup, and it's ridiculously slow recovering from a failed/interrupted first backup. <comment77981> I'll try that if the backup fails again. It is still working. Says it will take about a day for 393GB. <comment78028> Thank you. `sudo rm -rf /var/folders/*` did the trick in my case <comment78535> FYI. This may have solved the problem with 10.7.5, but not with 10.8.2. <comment79387> This did not work for me. In my case, TM hangs after a time. Disabling Spotlight did not help at all. <comment79875> @jschmidt Did you try the 10.8.2 supplemental? The 10.7.5 supplemental update included changes to lsboxd, xpchelper, and a bunch of audio stuff. Also changes to xpchelper's SandBox permissions to include `ocspd` (though no changes to mdworker stuff). What does `/System/Library/Sandbox/Profiles/com.apple.xpchelper.sb` look like post supplemental? <comment83015> Yes. I tried the supplemental update on 10.8.2, but it didn't help. The only thing that has worked for me is a complete system wipe and reinstall of the OS. I manually copied my data from another backup, but did not restore any apps or settings. <comment92096> But, the comment at the top of system.sb says, "The contents of this file are also auto-generated and not user editable; it may be overwritten at any time." <comment107498> Since this is still a highly-ranked thread and this is a highly-ranked comment I'll add this, even if it's much later: adding this to mdworker.sb seems to contravene an earlier line in that file, "(deny mach-lookup (global-name "com.apple.ls.boxd") (with no-log))" which is explicitly denying access (though failing to not log when it does so), so I'm unsure it's wise to deliberately subvert that. <comment307526> It's a long time since I updated, but I still get this problem from time to time.  Any thoughts? <comment312207> Do not remove the content of `/var/folders` on El Capitan, it will totally hose your system: the progress bar would stop during the log in, I had to reinstall a TM backup. For the record, TM was impossibly slow on my machine due to [MenuMeters](https://github.com/yujitach/MenuMeters/issues/19).