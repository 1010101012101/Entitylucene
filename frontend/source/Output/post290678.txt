iMac restarts instead of shutting down <body> I have a problem with my iMac restarting when it should be shutting down. This doesn't happen all the time but appears to happen more frequently when I've had the computer on for a few hours.  strongWhat happens/strong  ol liI shut the computer down via Apple Menu  Shut Down/li liThe shut down cycle completes/li liThe computer immediately reboots/li /ol  It doesn't behave like this Mac OS X never shuts down. The Mac responds to being shut down immediately.  strongFixes I've tried/strong  First I should state I've pulled out all USBs etc. The only wire in is the power cable.  emDisk Utility/em  I've been in touch with Apple Support about this issue, and the only advice they could give was to run First Aid in the Disk Utility. Sometimes this allows me to shut down. Other times not.  emResetting the SMC/em  I've reset the SMC which doesn't help. This often leads to another issue which is freezing on reboot (Apple logo and progress bar that doesn't move). To fix this I reset the PRAM/VRAM  emReset the PRAM/VRAM/em  Resetting the PRAM allows me to shut down most of the time. Even then I have to do it 2 or 3 times before it works.  emComplete reinstall/upgrade/em  I've also reinstalled the system twice, one time upgrading from El Capitan to Sierra. This has temporarily fixed the issue, but it soon comes back after a week or so.  strongSetup/strong  iMac (27-inch, Late 2013)  3.4 GHz Intel Core i5  6 GB 1600 MHz DDR3  NVIDIA GeForce GTX 775M 2048 MB  macOS Sierra 10.12.5  strongEDIT:/strong Current Energy Saver Settings  img src="https://i.stack.imgur.com/y50oE.png" alt="Energy Saver Settings"  I'd really appreciate your help here guys, this has been going on a while and it's becoming a bit of a nuisance.  strongEDIT:/strong This question appears to highlight a pretty common occurrence. I'm happy to invest more into the bounty to get an answer that resolves or at least identifies the problem causing it to happen.  strongUPDATE:/strong  After going through the steps in the answer provided by @monomeeth, Apple Diagnostics uncovered an error codeNDT001: There may be an issue with the Thunderbolt hardware/code. I've run Diagnostics before, but this time I ran it straight after the Mac restarted from a failed shut down. I'll be taking it into Apple for repair, so I'll keep this answer up to date with the outcome.  <answer290901> Troubleshooting is a process of elimination and you seem to have started off well, doing most of the obvious first steps. Below are some additional steps I'd try next, especially since reinstalling macOS only resolved the problem for a week or so.  strongTest your iMac in Safe Mode/strong  Follow these steps to boot your iMac into Safe Mode:  ol liFully shut down your iMac/li liRestart your iMac/li liImmediately press the kbdShift/kbd key and strongkeep it down/strong /li liLet go of the kbdShift/kbd key when you see the login window (NOTE: If you have FileVault enabled you may need to log in twice)./li liTake a note of what happens (i.e. can you shut down normally or is the issue still present)/li liExit Safe Mode by restarting your iMac as normal/li liNow test again after the reboot/li /ol  Now, depending on the above testing, we can narrow down how to proceed:  ul liIf the problem strongis/strong still present emduring/em Safe Mode and afterwards, proceed to strong1. Run Apple Diagnostics/strong (see below). /li liIf the problem strongis not/strong present during Safe Mode then it's time to investigate login items, fonts, and kernel extensions. If that's the case, proceed to strong2. Investigating login items, fonts, and kernel extensions/strong (see below)./li /ul  hr strong1. Run Apple Diagnostics/strong  Follow the steps below to run Apple Diagnostics:  ol liFully shut down your iMac/li liRestart your iMac/li liImmediately press the kbdD/kbd key and strongkeep it down/strong until you see the Diagnostics screen appear/li liWait for Diagnostics to finish (this typically only takes a few minutes)/li liOnce complete, one of two things will appear on the screen:  ul lia emNo issues found/em message/li lia brief description of any errors found plus further instructions/li /ul/li liIf the diagnostics test does find errors, take a note of what they are/li /ol  strongNote:/strong If pressing and holding the kbdD/kbd key at Step 3 doesn't work, start again at Step 1 and, at Step 3 press and hold both the kbdOption/kbdkbdD/kbd keys instead. This will try and run diagnostics from the internet instead, so you will need to allow more time for it to complete.   hr strong2. Investigating login items, fonts, and kernel extensions/strong  Let's start with Login Items:  ol liStartup normally/li liGo to System Preferences  Users &amp; Groups/li liSelect the Login Items tab/li liTake a note of your Login Items /li liNow remove all of them by highlighting them and clicking on the kbd-/kbd button below/li liRestart your computer/li /ol  Now your Mac will boot up without those login items loading. Test this and see if the problem persists:   ul liIf the problem goes away you know one (or more) of the Login items were causing the problem. You can then add them back in one by one until you've identified the culprit. Problem solved./li liIf the problem does persist, it's either a problem with fonts you've installed yourself or with a 3rd party kernel extension. A little more info below:/li /ul  strongFonts:-/strong You can remove any of the fonts you've installed yourself to see if this makes a difference.  strongKernel Extensions:-/strong You can open Terminal (found within your Utilites folder) and enter the following command:  codekextstat | grep -v com.apple/code  The above command will list 3rd party kernel extensions (you may need to stretch the Terminal window so it's easier to read). Look for anything you don't remember installing, or something that belongs to software you've removed, or just anything that looks out of place. Remember though, this is a list of strong3rd party kernel extensions/strong and therefore any of them could be causing the problem.  <comment366938> I'm also interested as I know of a macbook (roughly 2009 ish) that does just about exactly the same but all the time - shut down : instant reboot... Tried smc, pram, complete reinstall etc so if anyone has any leads I would be pleased as well. Oh, not complaining I have 4 other macs in the house which are fine ! <comment367198> In Terminal, type the command `sudo poweroff` when you want to shut down - does it still exhibit the same behavior? <comment367199> Also, in *Sys Prefs - Energy Saver - Power* make sure the box *Start Up Automatically After Power Failure* is unchecked. <comment367205> Thx @Allan. Have posted current Energy Saver settings above. Will try `sudo poweroff` at next opportunity. <comment367215> Maybe try [Apple Diagnostics](https://support.apple.com/en-ca/HT202731) to see if itâ€™s a hardware issue <comment367232> What's the content of your Boot.plist? (`cat /Library/Preferences/SystemConfiguration/com.apple.Boot.plist`)  there is a space between *cat* and */Lib...*! <comment367253> Thanks @Monomeeth. There are definitely some things in your answer I haven't tried yet. Will let you know the outcome. <comment367594> Running through your answer brought something up @Monomeeth. Have updated the answer above. <comment367639> Ah yes, that could explain it. One thing though, if you happen to have any Thunderbolt devices connected, it'd be worth running Apple Diagnostics again without them attached to eliminate the possibility of a false positive due to an external cable/device. However, going to Apple is certainly a good course of action. And thanks for keeping us all updated, as this may help other users in future too. :)