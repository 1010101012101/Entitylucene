Spotlight borked after macOS Sierra update <body> strongConfig:/strong Late-2013 rMBP running 10.12 (16A323)  strongIssue:/strong Spotlight appears to be mostly non-functional since upgrading to Sierra. I originally noticed it when searches failed to bring up anything in Mail, and Spotlight itself will only surface results from Dictionary.  strongWhat I've Tried:/strong  ol liAdd my primary HDD to the Privacy exclusion list in Spotlight preferences (this resulted in a weird code(null)/code error). The idea is adding, then removing will force a reindex./li liRun codemdutil -sv //code to find out what's up, resulting in "Error: unexpected indexing state. kMDConfigSearchLevelTransitioning"./li liRun codesudo mdutil -E //code to delete and rebuild the index, resulting in "Error: Index is already changing state. Please try again in a moment."/li liRunbr codesudo su/codebr codelaunchctl unload -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist/codebr coderm -R ./Spotlight-V100//codebr codelaunchctl load -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist/codebr codemdutil -E //codebr this all works, and I get a brief pause after the last command before it spits out "Indexing enabled." Subsequent attempts at running codemdutil -sv //code spits out the aforementioned error as cited in #2 above./li /ol  Activity Monitor is showing that codemds/code and several codemdworker/code processes are churning most of the CPU cycles (and the fan is fairly vocal), which would imply that it's in the process of reindexing - yet the two ways I'm aware of confirming indexing behavior is not indicating that's the case:  ol licodemdutil -sv //code is returning that error./li liDoing a Spotlight search for anything (or "indexing" specifically) does not show any indexing progress bar./li /ol  So… is Spotlight either:  A. Actually indexing, despite both known ways of confirmation indicating it isn't? And, if so, citation(s) on that being the case / when can I expect it to be showing that it strongis/strong indexing?  B. Actually borked? And, if so, any other ways I can try to resolve absent nuking the partition, doing a fresh install, and restoring from Time Machine?  Thanks in advance!  <answer254053> Did you reboot after #4 above? I think that should work... If not this may help:  precodesudo touch /.metadata-never-index /code/pre  Reboot...  precodesudo rm /.Spotlight-V100/VolumeConfiguration.plist sudo rm /.metadata-never-index /code/pre  And reboot again. You can try this for every volume.  See also: http://www.filetypehelp.com/purpose-files-metadataneverindex-file-extension/  <answer254692> After leaving my Mac alone for the weekend, my fears were confirmed and there was never any change to this Spotlight issue. Given the other threads here and elsewhere, it appears that Sierra has some challenges when doing an in-place upgrade.   strongResolution:/strong  ol liConfirm you are fully backed up (multiple backups preferred). strongTHIS IS THE MOST IMPORTANT STEP!/strong/li liReboot into Recovery Mode (hold down Command-R while Mac begins to boot)./li liOpen "Disk Utility" and erase the macOS partition (You did confirm those backup(s), right?)./li liOnce HD is erased, exit out of "Disk Utility", open "Install macOS Sierra" and install Sierra from scratch. /li liAfter install completes, restore from backup. /li liGet back to your life. ;-)/li /ol  <comment316256> I was ~89% sure I had rebooted after doing #4 at least once, so I did it again and no change. Tried your alternative, but still getting the “unexpected indexing state” error when running `sudo mdutil -sv /` after the second reboot. <comment316259> Drat... What if you try `sudo pkill -9 mds` <comment316260> Running the `pkill` then checking the status using `mdutil` results once again with “Indexing enabled.” Spotlight search for “a” does yield a couple things in addition to the Dictionary meaning, but absolutely nothing comes up when searching in Mail. Running `mdutil -sv /` a second time brings back the error - and subsequent Spotlight searches goes back to only yielding Dictionary results. So it does appear that when mds is active is causing this “unexpected indexing state” and preventing any results outside of Dictionary entries. <comment316267> Hmmm... Other than killing it again and letting it index for a while (overnight?) I'm not sure what to try next. Sorry. <comment316270> Well, I’m not sure what good killing it again will do, as it auto-restarts. Since I’ve just recently done #4 complete with reboot, leaving it overnight and seeing if this is the new “this is how you know indexing is happening on Sierra” method might be the only option. Hopefully that’s it or someone else has the silver bullet as I *really* don’t want to clean install and restore from Time Machine… Thanks for the help @MacManager! <comment316420> Following up: Left it alone overnight and Spotlight is still basically non-functional. The mds process is active, but consuming no CPU cycles and `mdutil -sv /` is still reporting an “unexpected indexing state”. So unless there are any other ideas out there, it looks like I’ve got some exciting weekend plans involving a clean install and restore (I know you’re all jealous!). <comment316548> Since upgrading to Sierra i too have had mds and mds_stores taking up 100%+ CPU for almost a week now. I imagine Spotlight is working its way into my iCloud Photos and trying to index them and meta-data as well, but cannot confirm. I've tried most of the above mentioned suggestions, but mds/mds_stores always comes back (auto-restart). photolibraryd is also at the top of the cpu usage list, as well. mds and it swap places throughout the day. <comment316596> Thanks for the data point @Carl; I don't really have anything of significance on iCloud, so I don't think that's the issue for me (unless mds is getting hung up on what little data is on there). Are you having any issues with Spotlight searches at all? <comment316649> I don't usually use Spotlight search (I use Alfred), but it seems to be working once I enabled Spotlight to index a few items in system preference. I had unchecked all items previously, but adding a few back in (apps, docs, etc) allowed it to work when I opened up a Spotlight search. At this moment, photolibraryd is 93% CPU and mds* is  1%, fyi. <comment316651> I should also note that I have 40,000+ photos in iCloud and I recently (as of 2-3weeks ago) turned iCloud photos back on after using Google Photos for almost a year. So there could be some "catching-up" that iCloud+Photos are doing, but I don't think that means this situation (100-200% CPU) is "fine". It's hard to get work done when the machine is unresponsive most of the day, for days on end. I may end up backing up and starting over with a clean install of Sierra. <comment327826> Did reinstalling and restoring from backup fix your spotlight search issues? <comment327830> When you say restore from backup, do you mean a time machine backup? Wouldn't that kind of restore also bring back the spotlight problems? <comment327894> @muhan As noted in this answer that I accepted, restoring from back up did resolve the issue. And to clarify, yes, it was a Time Machine backup that I used. <comment328072> by `rm -R ./Spotlight-V100/` , I guess you mean  `rm -R /.Spotlight-V100/` <comment338391> Did you try installing Sierra without erasing the partition first? <comment338392> @AdamRice No, I did not. This was my main machine and I didn't have the further patience to do that. There's obviously no way now to know, but I'm not inclined to think that just doing the install over again the corrupted instance would've made a difference.